import{_ as s,o as a,c as n,V as l}from"./chunks/framework.16eef3c0.js";const A=JSON.parse('{"title":"RBAC","description":"","frontmatter":{},"headers":[],"relativePath":"note/kubernetes/guides/rbac.md"}'),o={name:"note/kubernetes/guides/rbac.md"},p=l(`<h1 id="rbac" tabindex="-1">RBAC <a class="header-anchor" href="#rbac" aria-label="Permalink to &quot;RBAC&quot;">​</a></h1><h2 id="role-clusterrole" tabindex="-1">Role &amp; ClusterRole <a class="header-anchor" href="#role-clusterrole" aria-label="Permalink to &quot;Role &amp; ClusterRole&quot;">​</a></h2><p>Role 和 ClusterRole 都是定义了角色（包含一些特定的权限），其中 Role 定义的角色是限定在某一个 namespace 内的，而 ClusterRole 定义的角色是作用于整个集群的，例如可以访问所有 Namespace 下的 Pod，还可以访问一些非限定在 Namespace 内的资源，例如 Node。</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Role</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod-reader</span></span>
<span class="line"><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">apiGroups</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># &quot;&quot; indicates the core API group</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pods</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">verbs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">watch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">list</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre></div><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterRole</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># &quot;namespace&quot; omitted since ClusterRoles are not namespaced</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">secret-reader</span></span>
<span class="line"><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">apiGroups</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">secrets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">verbs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">watch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">list</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre></div><p>通过如下命令可以查看所有的 resources 以及 verbs：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-owide</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#A6ACCD;">                              </span><span style="color:#C3E88D;">SHORTNAMES</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">APIGROUP</span><span style="color:#A6ACCD;">                       </span><span style="color:#C3E88D;">NAMESPACED</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">KIND</span><span style="color:#A6ACCD;">                             </span><span style="color:#C3E88D;">VERBS</span></span>
<span class="line"><span style="color:#FFCB6B;">bindings</span><span style="color:#A6ACCD;">                                                                      </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">Binding</span><span style="color:#A6ACCD;">                          </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">componentstatuses</span><span style="color:#A6ACCD;">                 </span><span style="color:#C3E88D;">cs</span><span style="color:#A6ACCD;">                                          </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">ComponentStatus</span><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">get list</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">configmaps</span><span style="color:#A6ACCD;">                        </span><span style="color:#C3E88D;">cm</span><span style="color:#A6ACCD;">                                          </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">ConfigMap</span><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">endpoints</span><span style="color:#A6ACCD;">                         </span><span style="color:#C3E88D;">ep</span><span style="color:#A6ACCD;">                                          </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">Endpoints</span><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">events</span><span style="color:#A6ACCD;">                            </span><span style="color:#C3E88D;">ev</span><span style="color:#A6ACCD;">                                          </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">Event</span><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">limitranges</span><span style="color:#A6ACCD;">                       </span><span style="color:#C3E88D;">limits</span><span style="color:#A6ACCD;">                                      </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">LimitRange</span><span style="color:#A6ACCD;">                       </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">namespaces</span><span style="color:#A6ACCD;">                        </span><span style="color:#C3E88D;">ns</span><span style="color:#A6ACCD;">                                          </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">Namespace</span><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">nodes</span><span style="color:#A6ACCD;">                             </span><span style="color:#C3E88D;">no</span><span style="color:#A6ACCD;">                                          </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">Node</span><span style="color:#A6ACCD;">                             </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">daemonsets</span><span style="color:#A6ACCD;">                        </span><span style="color:#C3E88D;">ds</span><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">apps</span><span style="color:#A6ACCD;">                           </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">DaemonSet</span><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">deployments</span><span style="color:#A6ACCD;">                       </span><span style="color:#C3E88D;">deploy</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">apps</span><span style="color:#A6ACCD;">                           </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">Deployment</span><span style="color:#A6ACCD;">                       </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">replicasets</span><span style="color:#A6ACCD;">                       </span><span style="color:#C3E88D;">rs</span><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">apps</span><span style="color:#A6ACCD;">                           </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">ReplicaSet</span><span style="color:#A6ACCD;">                       </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">statefulsets</span><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">sts</span><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">apps</span><span style="color:#A6ACCD;">                           </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">StatefulSet</span><span style="color:#A6ACCD;">                      </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">create delete deletecollection get list patch update watch</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">...</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">...</span></span></code></pre></div><h2 id="rolebinding-clusterrolebinding" tabindex="-1">RoleBinding &amp; ClusterRoleBinding <a class="header-anchor" href="#rolebinding-clusterrolebinding" aria-label="Permalink to &quot;RoleBinding &amp; ClusterRoleBinding&quot;">​</a></h2><p>RoleBinding 和 ClusterRoleBinding 是将 Role 和 ClusterRole 与 User，Group 或者 ServiceAccount 进行绑定，赋予后者相应的权限。</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># This role binding allows &quot;jane&quot; to read pods in the &quot;default&quot; namespace.</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RoleBinding</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">read-pods</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span></span>
<span class="line"><span style="color:#F07178;">subjects</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">User</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jane</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Name is case sensitive</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">apiGroup</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#F07178;">roleRef</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Role</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#this must be Role or ClusterRole</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod-reader</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># this must match the name of the Role or ClusterRole you wish to bind to</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">apiGroup</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io</span></span></code></pre></div><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># This cluster role binding allows anyone in the &quot;manager&quot; group to read secrets in any namespace.</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">read-secrets-global</span></span>
<span class="line"><span style="color:#F07178;">subjects</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Group</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">manager</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Name is case sensitive</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">apiGroup</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#F07178;">roleRef</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterRole</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">secret-reader</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">apiGroup</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io</span></span></code></pre></div><p>Role 和 ClusterRole 还可以绑定到 ServiceAccount，例如：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">read-secrets-global</span></span>
<span class="line"><span style="color:#F07178;">subjects</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ServiceAccount</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kube-system</span></span>
<span class="line"><span style="color:#F07178;">roleRef</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterRole</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">secret-reader</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">apiGroup</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io</span></span></code></pre></div><h2 id="资源引用" tabindex="-1">资源引用 <a class="header-anchor" href="#资源引用" aria-label="Permalink to &quot;资源引用&quot;">​</a></h2><h3 id="subresource" tabindex="-1">subresource <a class="header-anchor" href="#subresource" aria-label="Permalink to &quot;subresource&quot;">​</a></h3><p>例如 Pod 的日志，就是 Pod 的子资源，URL 路径如下：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">GET /api/v1/namespaces/{namespace}/pods/{name}/log</span></span></code></pre></div><p>在 Role 或 ClusterRole 定义中，可以使用 <code>pods/log</code> 来表示日志资源，例如：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Role</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pod-and-pod-logs-reader</span></span>
<span class="line"><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">apiGroups</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pods</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pods/log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">verbs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">list</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre></div><h3 id="resourcenames" tabindex="-1">resourceNames <a class="header-anchor" href="#resourcenames" aria-label="Permalink to &quot;resourceNames&quot;">​</a></h3><p><code>resourceNames</code> 可以指定特定的资源名称，如果设定的话，则只能访问指定名字的资源。例如：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Role</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configmap-updater</span></span>
<span class="line"><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">apiGroups</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">configmaps</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resourceNames</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">my-configmap</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">verbs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">update</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre></div><h2 id="clusterrole-组合" tabindex="-1">ClusterRole 组合 <a class="header-anchor" href="#clusterrole-组合" aria-label="Permalink to &quot;ClusterRole 组合&quot;">​</a></h2><p>一个 ClusterRole 可以由多个 ClusterRole 组合而成，它的权限是组成它的所有 ClusterRole 的权限的并集。例如：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterRole</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">monitoring</span></span>
<span class="line"><span style="color:#F07178;">aggregationRule</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">clusterRoleSelectors</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">rbac.example.com/aggregate-to-monitoring</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># Rules are automatically filled in by the controller manager.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterRole</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">monitoring-endpoints</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">rbac.example.com/aggregate-to-monitoring</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># These rules will be added to the &quot;monitoring&quot; role.</span></span>
<span class="line"><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">apiGroups</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">services</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">endpoints</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pods</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">verbs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">list</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">watch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre></div><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noreferrer">Using RBAC Authorization</a></li></ul>`,27),e=[p];function t(c,r,D,y,C,F){return a(),n("div",null,e)}const u=s(o,[["render",t]]);export{A as __pageData,u as default};
