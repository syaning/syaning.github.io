import{_ as i,c as e,ah as s,o as t}from"./chunks/framework.B8QGmHkS.js";const l="/assets/homelab-network.BrbQ1aWv.svg",r="/assets/homelab-homepage.Vs4ZvDDU.webp",F=JSON.parse('{"title":"Homelab折腾总结","description":"","frontmatter":{"layout":"post","title":"Homelab折腾总结","date":"2026-01-12 22:00:00 +0800"},"headers":[],"relativePath":"tech/posts/2026/2026-01-12-homelab.md","filePath":"tech/posts/2026/2026-01-12-homelab.md"}'),d={name:"tech/posts/2026/2026-01-12-homelab.md"};function n(h,a,o,p,k,c){return t(),e("div",null,a[0]||(a[0]=[s('<h2 id="设备" tabindex="-1">设备 <a class="header-anchor" href="#设备" aria-label="Permalink to &quot;设备&quot;">​</a></h2><ul><li>网络 <ul><li>路由器: 小米路由器 BE6500 Pro</li><li>交换机: 小米万兆交换机</li></ul></li><li>存储: <ul><li>NAS: Synology DS220+ (2*16T, RAID1)</li></ul></li><li>计算: <ul><li>MiniServer: M4 MacMini (24G+256G)</li><li>DevServer: 零刻 SER8 8745HS 迷你主机 (32G+1T)</li></ul></li></ul><h2 id="基本原则" tabindex="-1">基本原则 <a class="header-anchor" href="#基本原则" aria-label="Permalink to &quot;基本原则&quot;">​</a></h2><p>核心理念:</p><ul><li>配置简单</li><li>运行稳定</li><li>对网络暂无特别高的要求</li></ul><p>设备角色：</p><ul><li>NAS 尽量只做存储使用，不部署其它不必要的服务</li><li>MiniServer 作为生产环境，部署需要长期稳定运行的服务</li><li>DevServer 作为开发环境，用于平时开发测试，以及部署一些临时服务</li><li>MiniServer 同时承担网关角色，统一流量入口</li></ul><h2 id="网络" tabindex="-1">网络 <a class="header-anchor" href="#网络" aria-label="Permalink to &quot;网络&quot;">​</a></h2><h3 id="网络拓扑" tabindex="-1">网络拓扑 <a class="header-anchor" href="#网络拓扑" aria-label="Permalink to &quot;网络拓扑&quot;">​</a></h3><p><img src="'+l+`" alt=""></p><h3 id="内网-dns" tabindex="-1">内网 DNS <a class="header-anchor" href="#内网-dns" aria-label="Permalink to &quot;内网 DNS&quot;">​</a></h3><p>出于部署方便，直接在 MiniServer 上 docker 部署了 <a href="https://adguard.com/en/adguard-home/overview.html" target="_blank" rel="noreferrer">AdGuard Home</a></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> adguardhome</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unless-stopped</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./work:/opt/adguardhome/work</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./conf:/opt/adguardhome/conf</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 53:53/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 53:53/udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3000:3000/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  adguard/adguardhome:v0.107.71</span></span></code></pre></div><p>然后：</p><ol><li>将路由器的 DHCP 配置中，DNS 配置修改为 MiniServer 的 IP（修改第一个 DNS 配置，第二个保留为运营商的配置作为兜底）</li><li>AdGuard Home 中设置 DNS Rewrite，将自己的内网域名 A 记录（<code>@</code> 和 <code>*</code>）配置为 MiniServer 的 IP</li></ol><p>例如：</p><ul><li>MiniServer IP 为 <code>192.168.31.2</code>，自定义内网域名为 <code>myhomelab.com</code>（仅作为示例）</li><li>路由器 DHCP 的 DNS 配置为 <code>192.168.31.2</code></li><li>AdGuard Home 中设置 <code>myhomelab.com</code> 和 <code>*.myhomelab.com</code> 为 <code>192.168.31.2</code></li></ul><p>这样后续就可以通过自定义的域名来访问内网服务了。</p><h3 id="异地组网" tabindex="-1">异地组网 <a class="header-anchor" href="#异地组网" aria-label="Permalink to &quot;异地组网&quot;">​</a></h3><p>使用 <a href="https://tailscale.com/" target="_blank" rel="noreferrer">Tailscale</a>。</p><ol><li>在 MiniServer 以及需要远程访问的设备上安装 Tailscale</li><li>之前自定义内网域名为 <code>myhomelab.com</code>，同时也购买了公网域名</li><li>在域名提供商解析域名 <code>myhomelab.com</code> 的 A 记录（<code>@</code> 和 <code>*</code>），IP 使用 tailscale 提供的 <code>100.x.y.z</code> 地址</li></ol><p>这样内外网都可以统一通过域名来进行访问。</p><h2 id="服务" tabindex="-1">服务 <a class="header-anchor" href="#服务" aria-label="Permalink to &quot;服务&quot;">​</a></h2><table tabindex="0"><thead><tr><th>服务</th><th>部署形态</th><th>部署位置</th></tr></thead><tbody><tr><td>Jellyfin</td><td>直接部署</td><td>MiniServer</td></tr><tr><td>AdGuard Home</td><td>Docker</td><td>MiniServer</td></tr><tr><td>Traefik Proxy</td><td>k8s</td><td>MiniServer</td></tr><tr><td>Gitea</td><td>k8s</td><td>MiniServer</td></tr><tr><td>Grafana</td><td>k8s</td><td>MiniServer</td></tr><tr><td>Prometheus</td><td>k8s</td><td>MiniServer</td></tr><tr><td>其它开发相关</td><td>直接部署/docker</td><td>DevServer</td></tr></tbody></table><h2 id="效果" tabindex="-1">效果 <a class="header-anchor" href="#效果" aria-label="Permalink to &quot;效果&quot;">​</a></h2><p>使用 <a href="https://gethomepage.dev/" target="_blank" rel="noreferrer">homepage</a> 部署了个首页导航，效果如下：</p><p><img src="`+r+'" alt=""></p>',27)]))}const u=i(d,[["render",n]]);export{F as __pageData,u as default};
