import{_ as s,o as n,c as a,V as l}from"./chunks/framework.16eef3c0.js";const F=JSON.parse('{"title":"Ingress","description":"","frontmatter":{},"headers":[],"relativePath":"notes/kubernetes/resources/ingress.md"}'),p={name:"notes/kubernetes/resources/ingress.md"},o=l(`<h1 id="ingress" tabindex="-1">Ingress <a class="header-anchor" href="#ingress" aria-label="Permalink to &quot;Ingress&quot;">​</a></h1><h2 id="ingress-和-ingress-controller" tabindex="-1">Ingress 和 Ingress Controller <a class="header-anchor" href="#ingress-和-ingress-controller" aria-label="Permalink to &quot;Ingress 和 Ingress Controller&quot;">​</a></h2><p>Ingress 可以将集群内的服务对外暴露，并且提供了负载均衡，HTTPS，以及基于域名的分流支持。Ingress 本身是一种配置，配置了如何对外提供服务。</p><p>如果需要 Ingress 真正生效，需要依赖于 Ingress Controller。可以简单类比为，Ingress Controller 就像是 Nginx，而 Ingress 则是 Nginx 的配置。</p><p>常见的 Ingress Controller 有多种，例如 <a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noreferrer">ingress-nginx</a>，<a href="https://www.getambassador.io/" target="_blank" rel="noreferrer">ambassador</a> 等，使用不同的 Ingress Controller 的时候，Ingress 的配置也会有所差别。</p><p>这里以 ingress-nginx 为例。</p><h2 id="安装-ingress-controller" tabindex="-1">安装 Ingress Controller <a class="header-anchor" href="#安装-ingress-controller" aria-label="Permalink to &quot;安装 Ingress Controller&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">helm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--namespace</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ingress-nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stable/nginx-ingress</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-n</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ingress-nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#A6ACCD;">                                                      </span><span style="color:#C3E88D;">READY</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">STATUS</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">RESTARTS</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">pod/nginx-nginx-ingress-controller-7d9449d76c-v4cf9</span><span style="color:#A6ACCD;">       </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">Running</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">30s</span></span>
<span class="line"><span style="color:#FFCB6B;">pod/nginx-nginx-ingress-default-backend-7f79f9545-9px9f</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">Running</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">30s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#A6ACCD;">                                          </span><span style="color:#C3E88D;">TYPE</span><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">CLUSTER-IP</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">EXTERNAL-IP</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">PORT</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">S</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">                      </span><span style="color:#C3E88D;">AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">service/nginx-nginx-ingress-controller</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">LoadBalancer</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">10.97.45.251</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">localhost</span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">80</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">30432</span><span style="color:#C3E88D;">/TCP,</span><span style="color:#F78C6C;">443</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">32760</span><span style="color:#C3E88D;">/TCP</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">30s</span></span>
<span class="line"><span style="color:#FFCB6B;">service/nginx-nginx-ingress-default-backend</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">ClusterIP</span><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">10.108.182.134</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">80</span><span style="color:#C3E88D;">/TCP</span><span style="color:#A6ACCD;">                       </span><span style="color:#C3E88D;">30s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#A6ACCD;">                                                  </span><span style="color:#C3E88D;">READY</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">UP-TO-DATE</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">AVAILABLE</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">deployment.apps/nginx-nginx-ingress-controller</span><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">            </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">30s</span></span>
<span class="line"><span style="color:#FFCB6B;">deployment.apps/nginx-nginx-ingress-default-backend</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">            </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">30s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#A6ACCD;">                                                            </span><span style="color:#C3E88D;">DESIRED</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">CURRENT</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">READY</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">replicaset.apps/nginx-nginx-ingress-controller-7d9449d76c</span><span style="color:#A6ACCD;">       </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">         </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">         </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">30s</span></span>
<span class="line"><span style="color:#FFCB6B;">replicaset.apps/nginx-nginx-ingress-default-backend-7f79f9545</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">         </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">         </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">30s</span></span></code></pre></div><h2 id="创建-ingress" tabindex="-1">创建 Ingress <a class="header-anchor" href="#创建-ingress" aria-label="Permalink to &quot;创建 Ingress&quot;">​</a></h2><h3 id="ip-访问" tabindex="-1">IP 访问 <a class="header-anchor" href="#ip-访问" aria-label="Permalink to &quot;IP 访问&quot;">​</a></h3><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">networking.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Ingress</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">annotations</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">kubernetes.io/ingress.class</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nginx</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">paths</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">backend</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">serviceName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">servicePort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ingress</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">HOSTS</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">ADDRESS</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">PORTS</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">   </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;">                 </span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">3s</span></span></code></pre></div><h3 id="域名分流" tabindex="-1">域名分流 <a class="header-anchor" href="#域名分流" aria-label="Permalink to &quot;域名分流&quot;">​</a></h3><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">networking.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Ingress</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">annotations</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">kubernetes.io/ingress.class</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nginx</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-example.com</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">paths</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">backend</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">serviceName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">servicePort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ingress</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">HOSTS</span><span style="color:#A6ACCD;">               </span><span style="color:#C3E88D;">ADDRESS</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">PORTS</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">nginx-example.com</span><span style="color:#A6ACCD;">             </span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">10s</span></span></code></pre></div><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noreferrer">Ingress</a></li><li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="noreferrer">Ingress Controllers</a></li></ul>`,17),e=[o];function r(t,c,C,y,D,A){return n(),a("div",null,e)}const g=s(p,[["render",r]]);export{F as __pageData,g as default};
