import{_ as s,o as a,c as n,a as p}from"./app.f3c12a67.js";const l="/assets/mac.dc4a08e8.svg",o="/assets/symmetric.644030a0.gif",e="/assets/asymmetric.b2c1ffe4.gif",c="/assets/signature.e05b917f.svg",u=JSON.parse('{"title":"Node\u6838\u5FC3\u6A21\u5757\u4E4Bcrypto","description":"","frontmatter":{"layout":"post","title":"Node\u6838\u5FC3\u6A21\u5757\u4E4Bcrypto","date":"2016-09-27 18:00:00 +0800"},"headers":[{"level":2,"title":"Hash","slug":"hash","link":"#hash","children":[]},{"level":2,"title":"HMAC","slug":"hmac","link":"#hmac","children":[]},{"level":2,"title":"Cipher & Decipher","slug":"cipher-decipher","link":"#cipher-decipher","children":[]},{"level":2,"title":"Sign & Verify","slug":"sign-verify","link":"#sign-verify","children":[]}],"relativePath":"my/post/2016-09-27-node-crypto.md"}'),t={name:"my/post/2016-09-27-node-crypto.md"},r=p(`<h2 id="hash" tabindex="-1">Hash <a class="header-anchor" href="#hash" aria-hidden="true">#</a></h2><p>\u54C8\u5E0C\u51FD\u6570\uFF08\u6563\u5217\u51FD\u6570\uFF09\u4E3B\u8981\u7528\u4E8E\u751F\u6210\u6D88\u606F\u6458\u8981(Message Digest)\uFF0C\u5373\u5C06\u4EFB\u610F\u5927\u5C0F\u7684\u6570\u636E\u6620\u5C04\u5230\u4E00\u4E2A\u56FA\u5B9A\u5927\u5C0F\u7684\u6570\u636E\u3002\u6700\u5E38\u89C1\u7684\u5982MD5\uFF0CSHA1\u7B49\u3002</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">---------  hash function  --------------</span></span>
<span class="line"><span style="color:#A6ACCD;">| input |----------------&gt;| hash value |</span></span>
<span class="line"><span style="color:#A6ACCD;">---------                 --------------</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5728Node\u4E2D\uFF0C\u901A\u8FC7<code>crypto.getHashes()</code>\u53EF\u4EE5\u67E5\u770B\u6240\u652F\u6301\u7684\u54C8\u5E0C\u7B97\u6CD5\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getHashes</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#676E95;">// =&gt; [ &#39;DSA&#39;, &#39;DSA-SHA&#39;, &#39;DSA-SHA1&#39;, ... ]</span></span>
<span class="line"></span></code></pre></div><p>\u4E0B\u9762\u662F\u4E00\u4E2AMD5\u7684\u4F8B\u5B50\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> hash </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createHash</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">md5</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">input</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">digest</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(hash)</span></span>
<span class="line"><span style="color:#676E95;">// =&gt; a43c1b0aa53a0c908810c06ab1ff3967</span></span>
<span class="line"></span></code></pre></div><h2 id="hmac" tabindex="-1">HMAC <a class="header-anchor" href="#hmac" aria-hidden="true">#</a></h2><p>\u5728\u4E86\u89E3HMAC\u4E4B\u524D\uFF0C\u9700\u8981\u5148\u4E86\u89E3MAC(Message Authentication Code)\uFF0C\u5373\u6D88\u606F\u8BA4\u8BC1\u7801\u3002</p><p>\u53D1\u9001\u65B9\u4F7F\u7528MAC\u7B97\u6CD5\u5C06\u6D88\u606F\u548C\u5BC6\u94A5\u8FDB\u884C\u8BA1\u7B97\uFF0C\u5F97\u5230MAC\u503C\uFF0C\u7136\u540E\u5C06\u6D88\u606F\u548CMAC\u503C\u53D1\u9001\u51FA\u53BB\u3002\u63A5\u6536\u65B9\u62FF\u5230\u6570\u636E\u540E\uFF0C\u901A\u8FC7\u76F8\u540C\u7684MAC\u7B97\u6CD5\u628A\u6D88\u606F\u548C\u5BC6\u94A5\u8FDB\u884C\u8BA1\u7B97\uFF0C\u548C\u6536\u5230\u7684MAC\u503C\u8FDB\u884C\u6BD4\u8F83\u3002\u5982\u679C\u4E00\u81F4\uFF0C\u5219\u8BF4\u660E\u6D88\u606F\u5728\u53D1\u9001\u8FC7\u7A0B\u4E2D\u6CA1\u6709\u88AB\u7BE1\u6539\u3002</p><p><img src="`+l+`" alt="MAC"></p><blockquote><p>\u56FE\u7247\u6765\u6E90\uFF1A<a href="https://upload.wikimedia.org/wikipedia/commons/0/08/MAC.svg" target="_blank" rel="noreferrer">https://upload.wikimedia.org/wikipedia/commons/0/08/MAC.svg</a></p></blockquote><p>HMAC\u5373Hash-based Message Authentication Code\uFF0C\u5373\u4F7F\u7528\u4E00\u4E2AHash\u51FD\u6570\u4F5C\u4E3AMAC\u7B97\u6CD5\u3002\u4F8B\u5982\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> hmac </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createHmac</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sha256</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">secret</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">digest</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(hmac)</span></span>
<span class="line"><span style="color:#676E95;">// =&gt; 8b5f48702995c1598c573db1e21866a9b825d4a794d169d7060a03605796360b</span></span>
<span class="line"></span></code></pre></div><p><a href="https://github.com/tj/node-cookie-signature" target="_blank" rel="noreferrer">cookie-signature</a>\u4E2D\u5BF9cookie\u7B7E\u540D\u7528\u7684\u5C31\u662FHMAC\u5B9E\u73B0\u3002</p><h2 id="cipher-decipher" tabindex="-1">Cipher &amp; Decipher <a class="header-anchor" href="#cipher-decipher" aria-hidden="true">#</a></h2><p>Cipher\u7528\u4E8E\u52A0\u5BC6\uFF0CDecipher\u7528\u4E8E\u89E3\u5BC6\u3002\u52A0\u5BC6\u5206\u4E3A\u5BF9\u79F0\u52A0\u5BC6\u548C\u975E\u5BF9\u79F0\u52A0\u5BC6\u3002</p><p>\u5BF9\u79F0\u52A0\u5BC6\u6307\u7684\u662F\u52A0\u5BC6\u548C\u89E3\u5BC6\u4F7F\u7528\u76F8\u540C\u7684\u5BC6\u94A5\u3002\u4F8B\u5982A\u5411B\u53D1\u6D88\u606F\uFF0CA\u4F7F\u7528\u5BC6\u94A5\u8FDB\u884C\u52A0\u5BC6\u53D1\u9001\u7ED9B\uFF0CB\u6536\u5230\u5BC6\u6587\u540E\u4F7F\u7528\u76F8\u540C\u7684\u5BC6\u94A5\u8FDB\u884C\u89E3\u5BC6\u4ECE\u800C\u5F97\u5230\u6D88\u606F\u660E\u6587\u3002\u7531\u4E8E\u52A0\u5BC6\u548C\u89E3\u5BC6\u4F7F\u7528\u7684\u662F\u76F8\u540C\u7684\u5BC6\u94A5\uFF0C\u56E0\u6B64\u52A0\u5165\u5BC6\u94A5\u6CC4\u9732\uFF0C\u90A3\u4E48\u522B\u4EBA\u622A\u83B7\u4E86\u6D88\u606F\u540C\u6837\u53EF\u4EE5\u8FDB\u884C\u89E3\u5BC6\u3002</p><p><img src="`+o+`" alt="Symmetric key cryptography"></p><blockquote><p>\u56FE\u7247\u6765\u6E90\uFF1A<a href="http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10500_.htm" target="_blank" rel="noreferrer">http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10500_.htm</a></p></blockquote><p>\u4E0B\u9762\u662F\u4E00\u4E2A\u4F7F\u7528aes256\u7B97\u6CD5\uFF08\u5BF9\u79F0\u52A0\u5BC6\uFF09\u7684\u4F8B\u5B50\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> cipher </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createCipher</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">aes256</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> encrypted </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cipher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">input</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">encrypted </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> cipher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">final</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(encrypted)</span></span>
<span class="line"><span style="color:#676E95;">// =&gt; fcfb38e53f2400797beb819795f6a459</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> decipher </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createDecipher</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">aes256</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> decrypted </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> decipher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(encrypted</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">decrypted </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> decipher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">final</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(decrypted)</span></span>
<span class="line"><span style="color:#676E95;">// =&gt; input</span></span>
<span class="line"></span></code></pre></div><p>\u975E\u5BF9\u79F0\u52A0\u5BC6\u6307\u7684\u662F\u52A0\u5BC6\u548C\u89E3\u5BC6\u4F7F\u7528\u4E0D\u540C\u7684\u5BC6\u94A5\u3002\u901A\u5E38\u4F1A\u6709\u4E00\u5BF9\u516C\u94A5\u548C\u79C1\u94A5\uFF0C\u7ECF\u8FC7\u516C\u94A5\u52A0\u5BC6\u7684\u6D88\u606F\u53EA\u6709\u4F7F\u7528\u79C1\u94A5\u624D\u80FD\u89E3\u5BC6\uFF0C\u7ECF\u8FC7\u79C1\u94A5\u52A0\u5BC6\u7684\u6D88\u606F\u53EA\u6709\u7ECF\u8FC7\u516C\u94A5\u624D\u80FD\u89E3\u5BC6\u3002\u4F8B\u5982A\u5411B\u53D1\u6D88\u606F\uFF0CA\u4F7F\u7528B\u7684\u516C\u94A5\u52A0\u5BC6\u6D88\u606F\u53D1\u9001\u51FA\u53BB\uFF0CB\u6536\u5230\u5BC6\u6587\u540E\u4F7F\u7528\u81EA\u5DF1\u7684\u79C1\u94A5\u8FDB\u884C\u89E3\u5BC6\u3002\u7531\u4E8EB\u7684\u79C1\u94A5\u53EA\u6709B\u62E5\u6709\uFF0C\u56E0\u6B64\u5982\u679C\u522B\u4EBA\u622A\u83B7\u4E86\u5BC6\u6587\uFF0C\u4E5F\u662F\u65E0\u6CD5\u89E3\u6790\u7684\u3002</p><p><img src="`+e+`" alt="Asymmetric key cryptography"></p><blockquote><p>\u56FE\u7247\u6765\u6E90\uFF1A<a href="http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10500_.htm" target="_blank" rel="noreferrer">http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10500_.htm</a></p></blockquote><p>\u4E0B\u9762\u662F\u4F7F\u7528rsa\u975E\u5BF9\u79F0\u52A0\u5BC6\u7684\u4F8B\u5B50\uFF1A</p><p>\u9996\u5148\u901A\u8FC7openssl\u6765\u751F\u6210\u4E00\u5BF9\u5BC6\u94A5\uFF1A</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ openssl genrsa -out rsa_private.key 2048</span></span>
<span class="line"><span style="color:#A6ACCD;">$ openssl rsa -pubout -in rsa_private.key -out rsa_public.key</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u662F\u52A0\u5BC6\u548C\u89E3\u5BC6\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> publicKey </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./key/rsa_public.key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> privateKey </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./key/rsa_private.key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> encryptedData</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> decryptedData</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// encrypt with public key and decrypt with private key</span></span>
<span class="line"><span style="color:#A6ACCD;">encryptedData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">publicEncrypt</span><span style="color:#A6ACCD;">(publicKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#A6ACCD;">(data))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">decryptedData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">privateDecrypt</span><span style="color:#A6ACCD;">(privateKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#A6ACCD;">(encryptedData</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(encryptedData) </span><span style="color:#676E95;">// 0a31e457f15526230d044bbeb711ec05b97d9f009...</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(decryptedData) </span><span style="color:#676E95;">// hello world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// encrypt with private key and decrypt with public key</span></span>
<span class="line"><span style="color:#A6ACCD;">encryptedData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">privateEncrypt</span><span style="color:#A6ACCD;">(privateKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#A6ACCD;">(data))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">decryptedData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">publicDecrypt</span><span style="color:#A6ACCD;">(publicKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#A6ACCD;">(encryptedData</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(encryptedData) </span><span style="color:#676E95;">// c116c5b501309251cb273bde20e8aa7abe6f4edff...</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(decryptedData) </span><span style="color:#676E95;">// hello world</span></span>
<span class="line"></span></code></pre></div><h2 id="sign-verify" tabindex="-1">Sign &amp; Verify <a class="header-anchor" href="#sign-verify" aria-hidden="true">#</a></h2><p>Sign\u7528\u4E8E\u6570\u5B57\u7B7E\u540D\uFF0CVerify\u7528\u4E8E\u9A8C\u8BC1\u7B7E\u540D\u3002\u6570\u5B57\u7B7E\u540D\u539F\u7406\u5982\u56FE\uFF1A</p><p><img src="`+c+`" alt="Signature"></p><blockquote><p>\u56FE\u7247\u6765\u6E90\uFF1A<a href="https://upload.wikimedia.org/wikipedia/commons/2/2b/Digital_Signature_diagram.svg" target="_blank" rel="noreferrer">https://upload.wikimedia.org/wikipedia/commons/2/2b/Digital_Signature_diagram.svg</a></p></blockquote><p>\u5728\u4E4B\u524D\u7684\u975E\u5BF9\u79F0\u52A0\u5BC6\u4E2D\uFF0C\u4F7F\u7528\u516C\u94A5\u8FDB\u884C\u52A0\u5BC6\uFF0C\u79C1\u94A5\u8FDB\u884C\u89E3\u5BC6\u3002\u5728\u751F\u6210\u548C\u9A8C\u8BC1\u6570\u5B57\u7B7E\u540D\u7684\u65F6\u5019\uFF0C\u4F1A\u4F7F\u7528\u79C1\u94A5\u8FDB\u884C\u7B7E\u540D\uFF0C\u516C\u94A5\u8FDB\u884C\u9A8C\u8BC1\u3002</p><p>\u901A\u8FC7openssl\u6765\u751F\u6210\u4E00\u5BF9\u5BC6\u94A5\uFF1A</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ openssl genrsa -out rsa_private.key 2048</span></span>
<span class="line"><span style="color:#A6ACCD;">$ openssl rsa -pubout -in rsa_private.key -out rsa_public.key</span></span>
<span class="line"></span></code></pre></div><p>\u4E0B\u9762\u662F\u4E00\u4E2A\u7B7E\u540D\u53CA\u9A8C\u8BC1\u7684\u4F8B\u5B50\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sign </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createSign</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">RSA-SHA256</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">sign</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">input</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> private_key </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rsa_private.key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> signature </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sign</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sign</span><span style="color:#A6ACCD;">(private_key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(signature)</span></span>
<span class="line"><span style="color:#676E95;">// =&gt; b9b339491522843e11cf0cc4a2de1ccccc2bff7d0......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> verify </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createVerify</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">RSA-SHA256</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">verify</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">input</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> public_key </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rsa_public.key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(verify</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">verify</span><span style="color:#A6ACCD;">(public_key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> signature</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"><span style="color:#676E95;">// =&gt; true</span></span>
<span class="line"></span></code></pre></div>`,39),y=[r];function D(A,F,C,i,d,h){return a(),n("div",null,y)}const b=s(t,[["render",D]]);export{u as __pageData,b as default};
