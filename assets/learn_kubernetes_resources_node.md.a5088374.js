import{_ as s,o as n,c as a,a as e}from"./app.9c5b3fde.js";const D=JSON.parse('{"title":"Node","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u7B80\u4ECB","slug":"\u7B80\u4ECB","link":"#\u7B80\u4ECB","children":[]},{"level":2,"title":"Taint","slug":"taint","link":"#taint","children":[]},{"level":2,"title":"\u7BA1\u7406","slug":"\u7BA1\u7406","link":"#\u7BA1\u7406","children":[{"level":3,"title":"cordon / uncordon","slug":"cordon-uncordon","link":"#cordon-uncordon","children":[]},{"level":3,"title":"drain","slug":"drain","link":"#drain","children":[]}]},{"level":2,"title":"\u53C2\u8003","slug":"\u53C2\u8003","link":"#\u53C2\u8003","children":[]}],"relativePath":"learn/kubernetes/resources/node.md"}'),l={name:"learn/kubernetes/resources/node.md"},o=e(`<h1 id="node" tabindex="-1">Node <a class="header-anchor" href="#node" aria-hidden="true">#</a></h1><h2 id="\u7B80\u4ECB" tabindex="-1">\u7B80\u4ECB <a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a></h2><p>\u901A\u8FC7\u5982\u4E0B\u65B9\u5F0F\u53EF\u4EE5\u67E5\u770B\u96C6\u7FA4\u7684\u8282\u70B9\u4FE1\u606F\uFF1A</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ kubectl get node</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME      STATUS   ROLES    AGE   VERSION</span></span>
<span class="line"><span style="color:#A6ACCD;">test-01   Ready    master   38d   v1.15.0</span></span>
<span class="line"><span style="color:#A6ACCD;">test-02   Ready    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">   38d   v1.15.0</span></span>
<span class="line"><span style="color:#A6ACCD;">test-03   Ready    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">   38d   v1.15.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">$ kubectl get node -owide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME      STATUS   ROLES    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE           KERNEL-VERSION      CONTAINER-RUNTIME</span></span>
<span class="line"><span style="color:#A6ACCD;">test-01   Ready    master   38d   v1.15.0   10.40.57.233   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">        Ubuntu 16.04 LTS   4.15.0-39-generic   docker://18.6.1</span></span>
<span class="line"><span style="color:#A6ACCD;">test-02   Ready    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">   38d   v1.15.0   10.40.57.71    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">        Ubuntu 16.04 LTS   4.15.0-39-generic   docker://18.6.1</span></span>
<span class="line"><span style="color:#A6ACCD;">test-03   Ready    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">   38d   v1.15.0   10.40.57.77    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">        Ubuntu 16.04 LTS   4.15.0-39-generic   docker://18.6.1</span></span>
<span class="line"></span></code></pre></div><p>Node \u9ED8\u8BA4\u6709\u5982\u4E0B\u6807\u7B7E\uFF1A</p><ul><li><code>kubernetes.io/arch</code></li><li><code>kubernetes.io/hostname</code></li><li><code>kubernetes.io/os</code></li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ kubectl get node test-01 -oyaml</span></span>
<span class="line"><span style="color:#A6ACCD;">apiVersion: v1</span></span>
<span class="line"><span style="color:#A6ACCD;">kind: Node</span></span>
<span class="line"><span style="color:#A6ACCD;">metadata:</span></span>
<span class="line"><span style="color:#A6ACCD;">  labels:</span></span>
<span class="line"><span style="color:#A6ACCD;">    kubernetes.io/arch: amd64</span></span>
<span class="line"><span style="color:#A6ACCD;">    kubernetes.io/hostname: test-01</span></span>
<span class="line"><span style="color:#A6ACCD;">    kubernetes.io/os: linux</span></span>
<span class="line"><span style="color:#A6ACCD;">    node-role.kubernetes.io/master: </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  name: test-01</span></span>
<span class="line"><span style="color:#A6ACCD;">spec:</span></span>
<span class="line"><span style="color:#A6ACCD;">  podCIDR: 10.244.0.0/24</span></span>
<span class="line"><span style="color:#A6ACCD;">  taints:</span></span>
<span class="line"><span style="color:#A6ACCD;">  - effect: NoSchedule</span></span>
<span class="line"><span style="color:#A6ACCD;">    key: node-role.kubernetes.io/master</span></span>
<span class="line"></span></code></pre></div><h2 id="taint" tabindex="-1">Taint <a class="header-anchor" href="#taint" aria-hidden="true">#</a></h2><p>\u8BE6\u60C5\u53C2\u8003 <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noreferrer">Taints and Tolerations</a>\u3002</p><p>Taint \u662F Node \u7684\u7279\u6027\uFF0C\u4E00\u822C\u5305\u542B <code>key</code>\uFF0C<code>value</code> \u548C <code>effect</code>\uFF0C\u8868\u793A\u5F62\u5F0F\u4E3A <code>key=value:effect</code>\u3002\u53EF\u4EE5\u4E3A Node \u6253\u4E0A taint\uFF0C\u4EE5\u53CA\u4E00\u5B9A\u7684\u526F\u4F5C\u7528\u3002\u901A\u8FC7 <code>kubectl taint</code> \u547D\u4EE4\u53EF\u4EE5\u4E3A Node \u6DFB\u52A0\u6216\u8005\u5220\u9664 taint\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;"># \u6DFB\u52A0 taint</span></span>
<span class="line"><span style="color:#A6ACCD;">$ kubectl taint node node-01 dedicated=special-user:NoSchedule</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># \u5220\u9664 taint</span></span>
<span class="line"><span style="color:#A6ACCD;">$ kubectl taint node node-01 dedicated:NoSchedule-</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u4E0A\u4E00\u90E8\u5206\u7684\u4F8B\u5B50\u4E2D\uFF0Cmaster \u8282\u70B9\u9ED8\u8BA4 taint \u5982\u4E0B\uFF1A</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki"><code><span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">taints</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">effect</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NoSchedule</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node-role.kubernetes.io/master</span></span>
<span class="line"></span></code></pre></div><p>\u901A\u5E38\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cmaster \u8282\u70B9\u662F\u4E0D\u5141\u8BB8\u8C03\u5EA6 Pod \u7684\uFF0C\u5982\u679C\u5E0C\u671B master \u8282\u70B9\u4E5F\u53EF\u4EE5\u8C03\u5EA6 Pod\uFF0C\u53EF\u4EE5\u6267\u884C\uFF1A</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">kubectl taint nodes --all node-role.kubernetes.io/master-</span></span>
<span class="line"></span></code></pre></div><p>effect \u7684\u53D6\u503C\u4E3A\uFF1A</p><ul><li><code>NoSchedule</code>\uFF1A\u7981\u6B62\u8C03\u5EA6</li><li><code>PreferNoSchedule</code>\uFF1A\u4F18\u5148\u4E0D\u8C03\u5EA6</li><li><code>NoExecute</code>\uFF1A\u4E0D\u8C03\u5EA6\u5230\u8BE5\u8282\u70B9\uFF0C\u540C\u65F6\u4F1A\u9A71\u9010\u5DF2\u7ECF\u8C03\u5EA6\u5230\u8BE5\u8282\u70B9\u7684 Pod</li></ul><h2 id="\u7BA1\u7406" tabindex="-1">\u7BA1\u7406 <a class="header-anchor" href="#\u7BA1\u7406" aria-hidden="true">#</a></h2><h3 id="cordon-uncordon" tabindex="-1">cordon / uncordon <a class="header-anchor" href="#cordon-uncordon" aria-hidden="true">#</a></h3><p><code>cordon</code> \u5C06\u8282\u70B9\u6807\u8BB0\u4E3A\u4E0D\u53EF\u8C03\u5EA6\uFF1B<code>uncordon</code> \u5C06\u8282\u70B9\u91CD\u65B0\u6807\u8BB0\u4E3A\u53EF\u8C03\u5EA6\u3002</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ kubectl cordon test-03</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME      STATUS                     ROLES    AGE   VERSION</span></span>
<span class="line"><span style="color:#A6ACCD;">test-01   Ready                      master   45d   v1.15.0</span></span>
<span class="line"><span style="color:#A6ACCD;">test-02   Ready                      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">   45d   v1.15.0</span></span>
<span class="line"><span style="color:#A6ACCD;">test-03   Ready,SchedulingDisabled   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">   45d   v1.15.0</span></span>
<span class="line"></span></code></pre></div><h3 id="drain" tabindex="-1">drain <a class="header-anchor" href="#drain" aria-hidden="true">#</a></h3><p>\u5982\u679C\u9700\u8981\u5C06\u4E00\u4E2A Node \u4ECE\u96C6\u7FA4\u4E2D\u79FB\u9664\uFF0C\u5219\u9700\u8981\u5148\u6267\u884C <code>kubectl drain &lt;node name&gt;</code> \u64CD\u4F5C\u3002\u8BE5\u64CD\u4F5C\u4F1A\uFF1A</p><ul><li>\u6807\u8BB0\u8BE5 Node \u4E3A\u4E0D\u53EF\u8C03\u5EA6 (<code>kubectl cordon &lt;node name&gt;</code>)</li><li>\u9A71\u9010\u8BE5 Node \u4E0A\u7684 Pod</li></ul><p>\u901A\u8FC7 <code>--ignore-daemonsets</code> \u53EF\u4EE5\u5FFD\u7565 DaemonSet\uFF1B\u5982\u679C\u6709 Pod \u4F7F\u7528\u672C\u5730\u5B58\u50A8\uFF0C\u4F8B\u5982 <code>emptyDir</code>\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>--delete-local-data</code> \u53C2\u6570\u3002</p><p><code>drain</code> \u64CD\u4F5C\u7ED3\u675F\u540E\uFF0C\u5373\u53EF\u5C06 Node \u4ECE\u96C6\u7FA4\u4E2D\u79FB\u9664\u3002\u5982\u679C\u60F3\u8981 Node \u7EE7\u7EED\u4F7F\u7528\uFF0C\u53EF\u4EE5\u901A\u8FC7 <code>kubectl uncordon &lt;node name&gt;</code>.</p><p>\u8BE5\u64CD\u4F5C\u5728\u9A71\u9010 Pod \u7684\u65F6\u5019\uFF0C\u4F1A\u9075\u5FAA <a href="./pod-disruption-budget.html">PodDisruptionBudget</a></p><h2 id="\u53C2\u8003" tabindex="-1">\u53C2\u8003 <a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a></h2><ul><li><a href="https://kubernetes.io/docs/concepts/architecture/nodes/" target="_blank" rel="noreferrer">Nodes</a></li><li><a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noreferrer">Taints and Tolerations</a></li><li><a href="https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/" target="_blank" rel="noreferrer">Safely Drain a Node while Respecting the PodDisruptionBudget</a></li></ul>`,29),t=[o];function p(c,r,d,i,C,A){return n(),a("div",null,t)}const u=s(l,[["render",p]]);export{D as __pageData,u as default};
