import{_ as s,o,c as e,a}from"./app.291da3e0.js";const l="/assets/handle.a5677b30.png",n="/assets/handle-layer.a4e3f7ef.png",u=JSON.parse('{"title":"\u6DF1\u5165\u7406\u89E3Express(1)","description":"","frontmatter":{"layout":"post","title":"\u6DF1\u5165\u7406\u89E3Express(1)","date":"2015-05-20 22:00:00 +0800"},"headers":[{"level":2,"title":"1. \u7406\u89E3app","slug":"_1-\u7406\u89E3app","link":"#_1-\u7406\u89E3app","children":[]},{"level":2,"title":"2. Router","slug":"_2-router","link":"#_2-router","children":[]},{"level":2,"title":"3. \u8DEF\u7531\u673A\u5236","slug":"_3-\u8DEF\u7531\u673A\u5236","link":"#_3-\u8DEF\u7531\u673A\u5236","children":[]},{"level":2,"title":"4. \u8BF7\u6C42\u5904\u7406","slug":"_4-\u8BF7\u6C42\u5904\u7406","link":"#_4-\u8BF7\u6C42\u5904\u7406","children":[]}],"relativePath":"my/post/2015-05-20-dive-into-express-1.md"}'),p={name:"my/post/2015-05-20-dive-into-express-1.md"},c=a(`<p>\u672C\u6587\u4E3B\u8981\u901A\u8FC7\u662F\u5BF9<a href="http://expressjs.com/" target="_blank" rel="noreferrer">Express</a>\u7684\u4E00\u4E2A\u8F83\u4E3A\u6DF1\u5165\u7684\u5206\u6790\uFF0C\u81F3\u4E8E\u5BF9Express\u7684\u6E90\u7801\u5206\u6790\uFF0C\u5728\u6211\u7684<a href="https://github.com/syaning/understanding-express" target="_blank" rel="noreferrer">Github</a>\u4E0A\u3002\u672C\u6587\u7684\u5206\u6790\u57FA\u4E8EExpress 4.12.3.</p><h2 id="_1-\u7406\u89E3app" tabindex="-1">1. \u7406\u89E3app <a class="header-anchor" href="#_1-\u7406\u89E3app" aria-hidden="true">#</a></h2><p>\u5728\u4F7F\u7528Express\u7684\u65F6\u5019\uFF0C\u6211\u4EEC\u901A\u8FC7\u5982\u4E0B\u65B9\u5F0F\u521B\u5EFA\u4E00\u4E2A\u5E94\u7528\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u800C\u5728\u4E0D\u4F7F\u7528\u6846\u67B6\u7684\u65F6\u5019\uFF0C\u901A\u5E38\u7684\u505A\u6CD5\u662F\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> http </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createServer</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">8000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u901A\u8FC7\u67E5\u770B\u6E90\u7801\uFF0C\u53EF\u4EE5\u53D1\u73B0\uFF0C<code>express</code>\u5B9E\u9645\u4E0A\u5C31\u662F\u4E00\u4E2A\u5DE5\u5382\u51FD\u6570\uFF0C\u7528\u6765\u521B\u5EFA<code>app</code>\uFF0C\u800C<code>app</code>\u5219\u5C31\u662F<code>createServer</code>\u7684\u56DE\u8C03\u51FD\u6570\u3002\u76F8\u5173\u6E90\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in express.js</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createApplication</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// ... ...</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// in application.js</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createServer</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">listen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arguments</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u56E0\u6B64\uFF0C\u5728\u4F7F\u7528Express\u7684\u65F6\u5019\uFF0C\u4E8B\u5B9E\u4E0A\uFF0C\u6240\u6709\u7684\u8BF7\u6C42\u90FD\u662F\u4EA4\u7ED9<code>app</code>\uFF0C\u901A\u8FC7<code>app.handle</code>\u6765\u5904\u7406\u4E86\u3002</p><p>\u901A\u8FC7\u5206\u6790application.js\u7684\u6E90\u7801\uFF0C\u53EF\u4EE5\u5F52\u7EB3\u51FA\uFF0C<code>app</code>\u4E3B\u8981\u6709\u5982\u4E0B\u5C5E\u6027\u548C\u65B9\u6CD5\uFF1A</p><ul><li><code>settings</code>\uFF0C{}\uFF0C\u4E3B\u8981\u662F\u4E00\u4E9B\u8BBE\u7F6E\u4FE1\u606F\uFF0C\u76F8\u5173\u65B9\u6CD5\u6709\uFF1A <ul><li><code>set(setting, value)</code>\uFF0C\u6709<code>value</code>\u7684\u65F6\u5019\u8FDB\u884C\u8BBE\u7F6E\uFF0C\u65E0<code>value</code>\u7684\u65F6\u5019\u8FDB\u884C\u83B7\u53D6</li><li><code>get(setting)</code></li><li><code>enabled(setting)</code></li><li><code>disabled(setting)</code></li><li><code>enable(setting)</code></li><li><code>disable(setting)</code></li></ul></li><li><code>cache</code>\uFF0C{}</li><li><code>engines</code>\uFF0C{}\uFF0C\u8BBE\u7F6E\u6A21\u7248\u5F15\u64CE\uFF0C\u76F8\u5173\u65B9\u6CD5\u6709\uFF1A <ul><li><code>engine(ext, fn)</code></li></ul></li><li><code>locals</code>\uFF0C{}</li><li><code>mountpath</code>\uFF0C\u5B57\u7B26\u4E32\uFF0C\u76F8\u5173\u65B9\u6CD5\u6709\uFF1A <ul><li><code>use(path, app)</code>\uFF0C\u4F1A\u8BBE\u7F6E<code>app</code>\u7684<code>mountpath</code>\u7684\u503C</li><li><code>path()</code>\uFF0C\u83B7\u53D6\u5E94\u7528\u7684\u7EDD\u5BF9\u8DEF\u5F84\u503C</li></ul></li><li><code>_router</code>\uFF0C<code>Router</code>\u5BF9\u8C61\uFF0C\u76F8\u5173\u65B9\u6CD5\u6709\uFF08\u7531\u4E8E\u53C2\u6570\u53EF\u4EE5\u6709\u591A\u79CD\u5F62\u5F0F\uFF0C\u56E0\u6B64\u5E76\u672A\u5217\u51FA\u53C2\u6570\uFF09\uFF1A <ul><li><code>route()</code>\uFF0C\u521B\u5EFA\u4E00\u6761\u8DEF\u7531\uFF0C\u4F1A\u8C03\u7528<code>Router.route</code></li><li><code>METHOD()</code>\uFF0C\u521B\u5EFA\u4E00\u6761\u8DEF\u7531\uFF0C\u5E76\u8C03\u7528VERB\u65B9\u6CD5\uFF0C\u4F1A\u8C03\u7528<code>Router.route</code></li><li><code>all()</code>\uFF0C\u521B\u5EFA\u4E00\u6761\u8DEF\u7531\uFF0C\u5E76\u8C03\u7528\u6240\u6709\u7684VERB\u65B9\u6CD5\uFF0C\u4F1A\u8C03\u7528<code>Router.route</code></li><li><code>param()</code>\uFF0C\u4F1A\u8C03\u7528<code>Router.param</code></li><li><code>use()</code>\uFF0C\u4F1A\u8C03\u7528<code>Router.use</code></li></ul></li></ul><h2 id="_2-router" tabindex="-1">2. Router <a class="header-anchor" href="#_2-router" aria-hidden="true">#</a></h2><p><code>app</code>\u6709\u4E00\u4E2A<code>_router</code>\u5C5E\u6027\uFF0C\u4E8B\u5B9E\u4E0A\u5C31\u662F\u4E00\u4E2A<code>Router</code>\u3002<code>Router</code>\u76F8\u5F53\u4E8E\u662F\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u5BB9\u5668\uFF0C\u5B58\u653E\u7740\u5404\u79CD\u5404\u6837\u7684\u4E2D\u95F4\u4EF6\uFF0C\u5927\u4F53\u4E0A\uFF0C\u53EF\u4EE5\u5206\u4E3A\u8DEF\u7531\u4E2D\u95F4\u4EF6\u548C\u5176\u5B83\u4E2D\u95F4\u4EF6\u3002<code>Router</code>\u7684\u4E3B\u8981\u5C5E\u6027\u548C\u65B9\u6CD5\u6709\uFF1A</p><ul><li><code>params</code>\uFF0C{} <ul><li><code>param()</code></li></ul></li><li><code>_params</code>\uFF0C[]</li><li><code>caseSensitive</code>\uFF0Cboolean</li><li><code>mergeParam</code>\uFF0Cboolean</li><li><code>strcit</code>\uFF0Cboolean</li><li><code>stack</code>\uFF0C[]\uFF0C\u5B58\u653E\u7740\u6240\u6709\u7684\u4E2D\u95F4\u4EF6\uFF0C\u76F8\u5173\u65B9\u6CD5\u6709\uFF1A <ul><li><code>use()</code>\uFF0C\u4F7F\u7528\u4E2D\u95F4\u4EF6\uFF0C\u672C\u8D28\u4E0A\u662F\u5411<code>stack</code>\u4E2D\u6DFB\u52A0\u4E00\u4E2A<code>Layer</code>\u5BF9\u8C61</li><li><code>route()</code>\uFF0C\u521B\u5EFA\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u672C\u8D28\u4E0A\u662F\u521B\u5EFA\u4E00\u4E2A<code>Route</code>\u5BF9\u8C61\uFF0C\u5E76\u4F7F\u7528\u8BE5<code>Route</code>\u5BF9\u8C61\u521B\u5EFA\u4E00\u4E2A<code>Layer</code>\u5BF9\u8C61\uFF0C\u5C06\u6B64<code>layer</code>\u5BF9\u8C61\u6DFB\u52A0\u5230<code>stack</code>\u4E2D</li><li><code>METHOD()</code>\uFF0C\u521B\u5EFA\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5E76\u6DFB\u52A0\u5904\u7406\u51FD\u6570\uFF0C\u5B9E\u9645\u4E0A\u662F\u8C03\u7528\u4E86<code>route()</code>\u65B9\u6CD5</li></ul></li></ul><p>\u6BCF\u4E2A\u4E2D\u95F4\u4EF6\u90FD\u662F\u4E00\u4E2A<code>Layer</code>\u5BF9\u8C61\uFF0C<code>Layer</code>\u5BF9\u8C61\u7684\u57FA\u672C\u5C5E\u6027\u6709\uFF1A</p><ul><li><code>handle</code>\uFF0Cfunction\uFF0C\u8868\u793A\u4E2D\u95F4\u4EF6\u51FD\u6570</li><li><code>name</code>\uFF0Cstring\uFF0C\u4E2D\u95F4\u4EF6\u51FD\u6570\u7684\u540D\u5B57\uFF0C\u5982\u679C\u4E3A\u533F\u540D\u51FD\u6570\u5219\u4E3A<code>&lt;anonymous&gt;</code></li><li><code>params</code>\uFF0Cundefined\uFF0C\u5728\u6267\u884C<code>match</code>\u7684\u65F6\u5019\u8D4B\u503C</li><li><code>path</code>\uFF0Cundefiend\uFF0C\u5728\u6267\u884C<code>match</code>\u7684\u65F6\u5019\u8D4B\u503C</li><li><code>regexp</code>\uFF0CRegExp\uFF0C\u8DEF\u5F84\u7684\u6B63\u5219\u8868\u8FBE\u5F62\u5F0F</li><li><code>keys</code>\uFF0C[]\uFF0C\u4FDD\u5B58\u7684\u662F\u8DEF\u5F84\u4E2D\u7684\u53C2\u6570\u53CA\u5176\u76F8\u5173\u7684\u4E00\u4E9B\u5176\u5B83\u4FE1\u606F</li><li><code>route</code>\uFF0C\u5982\u679C\u662F\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u8BE5\u5C5E\u6027\u4E3A\u4E00\u4E2A<code>Route</code>\u5BF9\u8C61\uFF0C\u5426\u5219\u4E3A<code>undefined</code>\u3002\u8BE5\u5C5E\u6027\u4E0D\u5728<code>Layer</code>\u6A21\u5757\u4E2D\u5B9A\u4E49\uFF0C\u800C\u662F\u5728<code>Router</code>\u6A21\u5757\u4E2D\u751F\u6210\u5B9E\u4F8B\u540E\u5B9A\u4E49</li></ul><h2 id="_3-\u8DEF\u7531\u673A\u5236" tabindex="-1">3. \u8DEF\u7531\u673A\u5236 <a class="header-anchor" href="#_3-\u8DEF\u7531\u673A\u5236" aria-hidden="true">#</a></h2><p>\u5728<code>Router</code>\u7684<code>stack</code>\u4E2D\uFF0C\u5B58\u653E\u7740\u591A\u4E2A\u4E2D\u95F4\u4EF6\uFF0C\u6BCF\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u90FD\u662F\u4E00\u4E2A<code>Layer</code>\u5BF9\u8C61\uFF0C\u5982\u679C\u8BE5\u4E2D\u95F4\u4EF6\u662F\u4E00\u4E2A\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u76F8\u5E94\u7684<code>Layer</code>\u5BF9\u8C61\u7684<code>route</code>\u5C5E\u6027\u4F1A\u6307\u5411\u4E00\u4E2A<code>Route</code>\u5BF9\u8C61\uFF0C\u8868\u793A\u4E00\u6761\u8DEF\u7531\u3002<code>Route</code>\u7684\u4E3B\u8981\u5C5E\u6027\u548C\u65B9\u6CD5\u6709\uFF1A</p><ul><li><code>path</code>\uFF0Cstring\uFF0C\u8868\u793A\u8DEF\u5F84</li><li><code>stack</code>\uFF0C[]\uFF0C\u5B58\u653E\u7684\u662F<code>Layer</code>\u5BF9\u8C61\uFF0C\u8868\u793A\u8DEF\u7531\u5904\u7406\u51FD\u6570</li><li><code>methods</code>\uFF0C{}\uFF0C\u8868\u660E\u652F\u6301\u54EA\u4E9BHTTP\u65B9\u6CD5\uFF0C\u4F8B\u5982<code>{ get: true }</code>\uFF0C\u5982\u679C\u4F7F\u7528\u4E86<code>all()</code>\uFF0C\u5219\u8BE5\u5C5E\u6027\u503C\u4E3A<code>{ _all: true }</code></li></ul><p>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C<code>Route</code>\u7684<code>stack</code>\u4E0E<code>Router</code>\u7684<code>stack</code>\u5B58\u653E\u7684\u90FD\u662F<code>Layer</code>\u5BF9\u8C61\uFF0C\u4F46\u662F\u8FD9\u4E24\u79CD<code>Layer</code>\u4E4B\u95F4\u6709\u5C11\u8BB8\u5DEE\u522B\uFF0C\u4E3B\u8981\u5982\u4E0B\uFF1A</p><ul><li>\u90FD\u5177\u6709<code>handle</code>\uFF0C<code>name</code>\uFF0C<code>params</code>\uFF0C<code>path</code>\uFF0C<code>regexp</code>\uFF0C<code>keys</code>\u5C5E\u6027\uFF0C\u8FD9\u51E0\u4E2A\u5C5E\u6027\u90FD\u662F\u5728<code>Layer</code>\u6A21\u5757\u7684\u6784\u9020\u51FD\u6570\u4E2D\u5B9A\u4E49\u7684</li><li><code>Router</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\u5177\u6709<code>route</code>\u5C5E\u6027\uFF0C\u5982\u679C\u8BE5\u5C5E\u6027\u4E0D\u4E3A<code>undefined</code>\uFF0C\u5219\u8868\u660E\u4E3A\u4E00\u4E2A\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF1B\u800C<code>Route</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\u6CA1\u6709<code>route</code>\u5C5E\u6027</li><li><code>Route</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\u5177\u6709<code>method</code>\u5C5E\u6027\uFF0C\u8868\u660E\u8BE5\u8DEF\u7531\u51FD\u6570\u7684HTTP\u65B9\u6CD5\uFF1B\u800C<code>Router</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\u6CA1\u6709<code>method</code>\u5C5E\u6027</li><li><code>Route</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\u7684<code>keys</code>\u5C5E\u6027\u503C\u5747\u4E3A<code>[]</code>\uFF0C<code>regexp</code>\u5C5E\u6027\u503C\u5747\u4E3A<code>/^\\/?$/i</code>\uFF0C\u56E0\u4E3A\u5728<code>Route</code>\u6A21\u5757\u4E2D\u521B\u5EFA<code>Layer</code>\u5BF9\u8C61\u65F6\u4F7F\u7528\u7684\u662F<code>Layer(&#39;/&#39;, {}, fn)</code></li></ul><p>\u521B\u5EFA\u8DEF\u7531\u7684\u4E3B\u8981\u65B9\u6CD5\u53CA\u5176\u8C03\u7528\u8FC7\u7A0B\u5982\u4E0B\uFF1A</p><ul><li><code>app.METHOD()</code> \u2192 <code>router.route</code> \u2192 <code>route.METHOD()</code></li><li><code>app.all()</code> \u2192 <code>router.route</code> \u2192 <code>route.METHOD()</code></li><li><code>app.route()</code> \u2192 <code>router.route</code></li></ul><p>\u4F8B\u5982\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/users/:username</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5BF9\u4E8E\u540C\u4E00\u8DEF\u5F84\u7684\u591A\u6B21\u8DEF\u7531\u6DFB\u52A0\u4F1A\u521B\u5EFA\u591A\u6761\u8DEF\u7531\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">foo</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">bar</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u8BE5\u4F8B\u5B50\u4F1A\u521B\u5EFA\u4E24\u6761\u8DEF\u7531\uFF0C\u5176\u4E2D\u7B2C\u4E00\u6761\u8DEF\u6709\u4E00\u4E2A\u5904\u7406\u51FD\u6570\uFF0C\u800C\u7B2C\u4E8C\u6761\u8DEF\u7531\u6709\u4E24\u4E2A\u5904\u7406\u51FD\u6570\u3002</p><h2 id="_4-\u8BF7\u6C42\u5904\u7406" tabindex="-1">4. \u8BF7\u6C42\u5904\u7406 <a class="header-anchor" href="#_4-\u8BF7\u6C42\u5904\u7406" aria-hidden="true">#</a></h2><p>\u5F53\u8BF7\u6C42\u5230\u6765\u65F6\uFF0C\u5904\u7406\u8FC7\u7A0B\u662F<code>app.handle</code> \u2192 <code>router.handle</code>\uFF0C\u4E8B\u5B9E\u4E0A\uFF0C<code>app.handle</code>\u8C03\u7528\u4E86<code>router.handle</code>\uFF0C\u800C<code>router.handle</code>\u7684\u8FC7\u7A0B\uFF0C\u5219\u662F\u4F9D\u6B21\u5BF9<code>router.stack</code>\u4E2D\u5B58\u653E\u7684\u4E2D\u95F4\u4EF6\u8FDB\u884C\u8C03\u7528\u3002\u793A\u4F8B\u56FE\u5982\u4E0B\uFF1A</p><p><img src="`+l+'" alt="handle request"></p><p><code>router.stack</code>\u4E2D\u5B58\u7684\u662F\u4E00\u4E2A\u4E2A\u7684<code>Layer</code>\u5BF9\u8C61\uFF0C\u7528\u6765\u7BA1\u7406\u4E2D\u95F4\u4EF6\u3002\u5982\u679C<code>Layer</code>\u5BF9\u8C61\u8868\u793A\u7684\u662F\u4E00\u4E2A\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u5176<code>route</code>\u5C5E\u6027\u4F1A\u6307\u5411\u4E00\u4E2A<code>Route</code>\u5BF9\u8C61\uFF0C\u800C<code>route.stack</code>\u4E2D\u5B58\u653E\u7684\u4E5F\u662F\u4E00\u4E2A\u4E2A\u7684<code>Layer</code>\u5BF9\u8C61\uFF0C\u7528\u6765\u7BA1\u7406\u8DEF\u7531\u5904\u7406\u51FD\u6570\u3002</p><p>\u56E0\u6B64\uFF0C\u5F53\u4E00\u4E2A\u8BF7\u6C42\u5230\u6765\u7684\u65F6\u5019\uFF0C\u4F1A\u4F9D\u6B21\u901A\u8FC7<code>router.stack</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\uFF0C\u5982\u679C\u9047\u5230\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u4F1A\u4F9D\u6B21\u901A\u8FC7<code>route.stack</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\u3002</p><p>\u5BF9\u4E8E<code>router.stack</code>\u4E2D\u7684\u6BCF\u4E2A<code>Layer</code>\u5BF9\u8C61\uFF0C\u4F1A\u5148\u5224\u65AD\u662F\u5426\u5339\u914D\u8BF7\u6C42\u8DEF\u5F84\uFF0C\u5982\u679C\u4E0D\u5339\u914D\uFF0C\u5219\u8DF3\u8FC7\uFF0C\u7EE7\u7EED\u4E0B\u4E00\u4E2A\u3002\u5728\u8DEF\u5F84\u5339\u914D\u7684\u60C5\u51B5\u4E0B\uFF0C\u5982\u679C\u662F\u975E\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u6267\u884C\u8BE5\u4E2D\u95F4\u4EF6\u51FD\u6570\uFF1B\u5982\u679C\u662F\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u7EE7\u7EED\u5224\u65AD\u8BE5\u4E2D\u95F4\u4EF6\u7684\u8DEF\u7531\u5BF9\u8C61\u80FD\u591F\u5904\u7406\u8BF7\u6C42\u7684HTTP\u65B9\u6CD5\uFF0C\u5982\u679C\u4E0D\u80FD\u591F\u5904\u7406\uFF0C\u5219\u8DF3\u8FC7\u7EE7\u7EED\u4E0B\u4E00\u4E2A\uFF0C\u5982\u679C\u80FD\u591F\u5904\u7406\u5219\u5BF9<code>route.stack</code>\u4E2D\u7684<code>Layer</code>\u5BF9\u8C61\uFF08\u4E0E\u8BF7\u6C42\u7684HTTP\u65B9\u6CD5\u5339\u914D\u7684\uFF09\u4F9D\u6B21\u6267\u884C\u3002\u793A\u4F8B\u56FE\u5982\u4E0B\uFF1A</p><p><img src="'+n+'" alt="handle layer"></p><p>\u5728\u4E2D\u95F4\u4EF6\u51FD\u6570\u6267\u884C\u4E4B\u524D\uFF0C\u4F1A\u5148\u5BF9\u53C2\u6570\u8FDB\u884C\u9884\u5904\u7406\uFF0C\u5373<code>router.process_params</code>\u3002\u5BF9\u4E8E\u6BCF\u4E2A\u53C2\u6570\u7684\u9884\u5904\u7406\u53EA\u4F1A\u8FDB\u884C\u4E00\u6B21\uFF0C\u4F46\u662F\u7531\u4E8E\u6BCF\u4E2Alayer\u6267\u884C\u4E4B\u524D\u90FD\u4F1A\u6709\u53C2\u6570\u9884\u5904\u7406\u7684\u8FC7\u7A0B\uFF0C\u56E0\u6B64\u6709\u4E00\u4E2A\u7F13\u5B58\u7CFB\u7EDF\uFF0C\u6765\u8BB0\u5F55\u54EA\u4E9B\u53C2\u6570\u5DF2\u7ECF\u5904\u7406\u8FC7\u4E86\u3002</p>',36),t=[c];function r(d,y,D,F,i,A){return o(),e("div",null,t)}const h=s(p,[["render",r]]);export{u as __pageData,h as default};
