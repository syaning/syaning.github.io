import{_ as i,c as a,a4 as h,o as t}from"./chunks/framework.zvAqeJ2b.js";const n="/assets/sysdig.BiRkYpRZ.png",y=JSON.parse('{"title":"使用 sysdig 进行系统分析","description":"","frontmatter":{"doctype":"post","title":"使用 sysdig 进行系统分析","date":"2020-12-15 00:00:00 +0800"},"headers":[],"relativePath":"posts/2020-12-15-sysdig.md","filePath":"posts/2020-12-15-sysdig.md"}'),k={name:"posts/2020-12-15-sysdig.md"};function l(p,s,e,F,d,r){return t(),a("div",null,s[0]||(s[0]=[h(`<h2 id="什么是-sysdig" tabindex="-1">什么是 sysdig？ <a class="header-anchor" href="#什么是-sysdig" aria-label="Permalink to &quot;什么是 sysdig？&quot;">​</a></h2><p>sysdig 是一个 Linux 系统诊断工具，并且提供了对容器的原生支持。可以认为它涵盖了 strace + tcpdump + htop + iftop + lsof + ... 等一系列系统工具的功能。</p><ul><li><a href="https://github.com/draios/sysdig" target="_blank" rel="noreferrer">Github</a></li><li><a href="https://sysdig.com/" target="_blank" rel="noreferrer">sysdig 官网</a></li><li><a href="https://github.com/draios/sysdig/wiki" target="_blank" rel="noreferrer">sysdig wiki</a></li></ul><p>相比于其它工具，sysdig 的优势在于：</p><ul><li>功能强大，并且使用方法和输出格式统一，无需使用不同的命令在不同的输出格式之间进行转换</li><li>云原生支持，可以对容器和 k8s 集群进行监控</li></ul><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://s3.amazonaws.com/download.draios.com/stable/install-sysdig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span></code></pre></div><h2 id="sysdig-输出" tabindex="-1">sysdig 输出 <a class="header-anchor" href="#sysdig-输出" aria-label="Permalink to &quot;sysdig 输出&quot;">​</a></h2><h3 id="默认输出" tabindex="-1">默认输出 <a class="header-anchor" href="#默认输出" aria-label="Permalink to &quot;默认输出&quot;">​</a></h3><p>默认可以直接执行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 需要 root 权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34378</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269753803</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> close fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/lib/locale/locale-archive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34379</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269754164</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> close res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34380</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269781699</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fstat fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/pts/3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34381</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269783882</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fstat res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34382</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269784970</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mmap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34383</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269786575</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mmap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34384</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269827674</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> write fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/pts/3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34385</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269839477</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> write res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hello</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> world.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34386</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269843986</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> close fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/pts/3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34387</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269844466</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> close res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34388</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269844816</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> munmap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34389</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269850803</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> munmap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34390</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269851915</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> close fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/pts/3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">34391</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 12:02:36.269852314</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (7896) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> close res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span></code></pre></div><p>默认的输出格式为：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>*%evt.num %evt.time %evt.cpu %proc.name (%thread.tid) %evt.dir %evt.type %evt.args</span></span></code></pre></div><p>其中：</p><ul><li>evt.num 是一个递增的序号</li><li>evt.time 是事件的发生时间</li><li>evt.cpu 是事件的cpu序号</li><li>proc.name 是进程名称</li><li>thread.top 是线程 id</li><li>evt.dir 是事件方向，&gt; 为进入事件，&lt; 为退出事件</li><li>evt.type 是事件类型，例如 read，open，write 等</li><li>evt.args 是事件参数列表</li></ul><h3 id="输出到文件" tabindex="-1">输出到文件 <a class="header-anchor" href="#输出到文件" aria-label="Permalink to &quot;输出到文件&quot;">​</a></h3><p>默认输出是在 terminal，可以将输出保存到文件中，然后 sysdig 再加载文件来进行分析。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sysdig 输出到文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dump.scap</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rotation 参考 https://sysdig.com/blog/sysdig-continuous-capture-with-file-rotation/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 例如每个文件大小为 1M，保留最新的 5 个文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -W</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dump.scap</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 读入文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dump.scap</span></span></code></pre></div><p>可以参考 <a href="https://sysdig.com/blog/sysdig-continuous-capture-with-file-rotation/" target="_blank" rel="noreferrer">Sysdig Continuous Capture with File Rotation</a> 查看更多输出到文件的示例。</p><h3 id="格式化输出" tabindex="-1">格式化输出 <a class="header-anchor" href="#格式化输出" aria-label="Permalink to &quot;格式化输出&quot;">​</a></h3><p>通过 <code>sysdig -j</code> 可以输出 JSON 格式，例如：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.cpu&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.dir&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;&gt;&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.info&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;next=0 pgft_maj=0 pgft_min=1385 vm_size=229324 vm_rss=15784 vm_swap=0 &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.num&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:7,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.outputtime&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1607781847452944277,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;switch&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;proc.name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sysdig&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;thread.tid&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:14550}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.cpu&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:0,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.dir&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;&gt;&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.info&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;interval=4000000(0.004s) &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.num&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:8,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.outputtime&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1607781847453039462,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;nanosleep&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;proc.name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;falco&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;thread.tid&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:12073}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.cpu&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:0,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.dir&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;&gt;&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.info&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;next=0 pgft_maj=70 pgft_min=3664 vm_size=407148 vm_rss=36156 vm_swap=4596 &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.num&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:9,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.outputtime&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1607781847453046982,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;switch&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;proc.name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;falco&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;thread.tid&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:12073}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.cpu&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.dir&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;&gt;&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.info&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;next=14550(sysdig) pgft_maj=0 pgft_min=0 vm_size=0 vm_rss=0 vm_swap=0 &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.num&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:10,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.outputtime&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1607781847453471349,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;switch&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;proc.name&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:null,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;thread.tid&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:0}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.cpu&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.dir&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;&gt;&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.info&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;next=14549(head) pgft_maj=0 pgft_min=1389 vm_size=229324 vm_rss=15784 vm_swap=0 &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.num&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:24,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.outputtime&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1607781847453669133,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;evt.type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;switch&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;proc.name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;sysdig&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;thread.tid&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:14550}</span></span></code></pre></div><p>通过 <code>sysdig -p &lt;format&gt;</code> 可以自定义输出格式，例如：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user:%user.name dir:%evt.arg.path&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user:messagebus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dir:/usr/share/dbus-1/system-services/org.freedesktop.nm_dispatcher.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user:messagebus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dir:/usr/share/dbus-1/system-services/org.freedesktop.Avahi.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user:messagebus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dir:/usr/share/dbus-1/system-services/org.freedesktop.UPower.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user:messagebus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dir:/usr/share/dbus-1/system-services/fi.w1.wpa_supplicant1.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user:messagebus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dir:/usr/share/dbus-1/system-services/org.freedesktop.ModemManager1.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user:messagebus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dir:/usr/share/dbus-1/system-services/org.freedesktop.RealtimeKit1.service</span></span></code></pre></div><ul><li>变量前面需要添加 <code>%</code></li><li>默认情况下，只有在所有变量都存在的情况下才会打印出来啊。如果需要允许字段不存在，使用 <code>*%user.name</code> 类似格式，即前面加一个 <code>*</code> ，此时不存在的字段会打印出 <code>&lt;NA&gt;</code></li></ul><h3 id="csysdig" tabindex="-1">csysdig <a class="header-anchor" href="#csysdig" aria-label="Permalink to &quot;csysdig&quot;">​</a></h3><p>通过 <code>sudo csysdig</code> 可以查看图形化的展示，类似于 <code>top</code> 命令看到的效果，如图所示：</p><p><img src="`+n+`" alt="image.png"></p><h2 id="filter" tabindex="-1">Filter <a class="header-anchor" href="#filter" aria-label="Permalink to &quot;Filter&quot;">​</a></h2><p>sysdig 提供了强大的过滤功能，用来进行筛选。例如：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proc.name=cat</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proc.name=cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> evt.type=read</span></span></code></pre></div><p>操作符支持：=，!=，&lt;，&lt;=，&gt;，&gt;=，contains，icontains，in，exists 逻辑操作支持：and，or，not</p><p>通过 <code>sysdig -l</code> 可以查看所有支持的 filter，有如下几类：</p><ul><li>fd</li><li>process</li><li>evt</li><li>user</li><li>group</li><li>syslog</li><li>container</li><li>fdlist</li><li>k8s</li><li>mesos</li><li>span</li><li>evtin</li></ul><h2 id="chisels" tabindex="-1">Chisels <a class="header-anchor" href="#chisels" aria-label="Permalink to &quot;Chisels&quot;">​</a></h2><p>sysdig chisel 是 Lua 编写的脚本，可以用来对事件进行分析。通过 <code>sysdig -cl</code> 可以查看 chisesl 列表。主要有以下几类：</p><ul><li>Application</li><li>CPU Usage</li><li>Errors</li><li>I/O</li><li>Logs</li><li>Misc</li><li>Net</li><li>Performance</li><li>Security</li><li>System State</li><li>Tracers</li></ul><p>通过 <code>sysdig -i &lt;chiselnaame&gt;</code> 可以查看 chisel 信息，通过 <code>sysdig -c &lt;chiselname&gt; [args]</code> 可以运行一个 chisel。例如：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Category:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> System</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> State</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">----------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (and </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">optionally</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) the machine processes.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> processes,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> an</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> that</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> similar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> one</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Ou</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tput</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> point</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">adjust</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> It</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> defaults</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> e</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vt.num</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Args:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[filter] filter - A sysdig-like filter expression that allows r</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                estricting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> For</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fd.name contains /etc&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sho</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                ws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> processes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> that</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> have</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> open</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> under</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proc.name=bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     PID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     USER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      VIRT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       RES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        FDLIMIT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">16201</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   16201</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   admin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     29.26M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5.61M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1024</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">20480</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   20480</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   admin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     29.26M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     5.59M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1024</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      bash</span></span></code></pre></div><h2 id="云原生支持" tabindex="-1">云原生支持 <a class="header-anchor" href="#云原生支持" aria-label="Permalink to &quot;云原生支持&quot;">​</a></h2><p>sysdig 对云原生场景有很好的支持，Filter 包含 container 和 k8s，例如：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container.name=nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 23:12:55.568063000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container:eda15d667287</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (-1) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> container json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;container&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Mounts</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:[],&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cpu_period</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:100000,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cpu_quota</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:0,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cpu_shares</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1024,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cpuset_cpu_count</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:0,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">created_time</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:1607784243,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">env</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:[],&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">full_id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eda15d667287f94c26fde54f725f63b348f932455f2af80fdf6a3ae3eb70a04f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eda15d667287</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">image</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx:1.17-alpine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">imagedigest</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sha256:763e7f0188e378fef0c761854552c70bbd817555dc4de029681a2e972e25e30e</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">imageid</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">89ec9da682137d6b18ab8244ca263b6771067f251562f884c7510c8f1e5ac910</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">imagerepo</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">imagetag</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1.17-alpine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.17.0.2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">is_pod_sandbox</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:false,&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">labels</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:{&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">maintainer</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NGINX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Maintainers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker-maint@nginx.co</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;},&quot;lookup_state&quot;:1,&quot;memory_limit&quot;:0,&quot;metadata_deadline&quot;:0,&quot;name&quot;:&quot;nginx&quot;,&quot;port_mappings&quot;:[{&quot;ContainerPort&quot;:80,&quot;HostIp&quot;:0,&quot;HostPort&quot;:8080}],&quot;privileged&quot;:false,&quot;swap_limit&quot;:0,&quot;type&quot;:0}}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94652 23:13:04.245968331 1 nginx (14766) &lt; epoll_pwait </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94653 23:13:04.245981938 1 nginx (14766) &gt; accept flags=0 </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94654 23:13:04.245987609 1 nginx (14766) &lt; accept fd=7(&lt;4t&gt;172.17.0.1:47566-&gt;172.17.0.2:80) tuple=172.17.0.1:47566-&gt;172.17.0.2:80 queuepct=0 queuelen=0 queuemax=511 </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94655 23:13:04.245994319 1 nginx (14766) &gt; epoll_ctl </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94656 23:13:04.245996892 1 nginx (14766) &lt; epoll_ctl </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94657 23:13:04.245998144 1 nginx (14766) &gt; epoll_pwait </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94658 23:13:04.246001866 1 nginx (14766) &gt; switch next=15088(curl) pgft_maj=0 pgft_min=153 vm_size=6420 vm_rss=1868 vm_swap=0 </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94681 23:13:04.246077541 1 nginx (14766) &lt; epoll_pwait </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94682 23:13:04.246081494 1 nginx (14766) &gt; recvfrom fd=7(&lt;4t&gt;172.17.0.1:47566-&gt;172.17.0.2:80) size=1024 </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">94683 23:13:04.246084084 1 nginx (14766) &lt; recvfrom res=78 data=GET / HTTP/1.1..Host: localhost:8080..User-Agent: curl/7.58.0..Accept: */*.... tuple=NULL</span></span></code></pre></div><p>sysdig 对容器也有比较好的支持，例如：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">topcontainers_cpu</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Top</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CPU</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> usage</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">topcontainers_error</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Top</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> errors</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">topcontainers_file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Top</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> R+W</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">topcontainers_net</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Top</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> I/O</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lscontainers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    List</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lscontainers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">container.type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container.image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> container.name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      container.id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--------------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---------------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -------------------</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ------------</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         nginx:1.17-alpi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               eda15d667287</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sysdig</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> topcontainers_cpu</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CPU%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                container.name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--------------------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.90%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              host</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               nginx</span></span></code></pre></div><p>可以参考 <a href="https://sysdig.com/blog/let-light-sysdig-adds-container-visibility/" target="_blank" rel="noreferrer">Let there be light – Sysdig adds container visibility</a> 查看更多介绍。</p>`,45)]))}const o=i(k,[["render",l]]);export{y as __pageData,o as default};
