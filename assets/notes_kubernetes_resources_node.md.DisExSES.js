import{_ as s,c as i,o as a,a4 as n}from"./chunks/framework.C7_4Vmd4.js";const c=JSON.parse('{"title":"Node","description":"","frontmatter":{},"headers":[],"relativePath":"notes/kubernetes/resources/node.md","filePath":"notes/kubernetes/resources/node.md"}'),t={name:"notes/kubernetes/resources/node.md"},e=n(`<h1 id="node" tabindex="-1">Node <a class="header-anchor" href="#node" aria-label="Permalink to &quot;Node&quot;">​</a></h1><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p>通过如下方式可以查看集群的节点信息：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    master</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   38d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   38d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-03</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   38d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -owide</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   INTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   OS-IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           KERNEL-VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      CONTAINER-RUNTIME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    master</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   38d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.40.57.233</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16.04</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   4.15.0-39-generic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   docker://18.6.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   38d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.40.57.71</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16.04</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   4.15.0-39-generic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   docker://18.6.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-03</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   38d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.40.57.77</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16.04</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   4.15.0-39-generic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   docker://18.6.1</span></span></code></pre></div><p>Node 默认有如下标签：</p><ul><li><code>kubernetes.io/arch</code></li><li><code>kubernetes.io/hostname</code></li><li><code>kubernetes.io/os</code></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-01</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -oyaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Node</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  labels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    kubernetes.io/arch:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> amd64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    kubernetes.io/hostname:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-01</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    kubernetes.io/os:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linux</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    node-role.kubernetes.io/master:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-01</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spec:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  podCIDR:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.244.0.0/24</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  taints:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> effect:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NoSchedule</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    key:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node-role.kubernetes.io/master</span></span></code></pre></div><h2 id="taint" tabindex="-1">Taint <a class="header-anchor" href="#taint" aria-label="Permalink to &quot;Taint&quot;">​</a></h2><p>详情参考 <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noreferrer">Taints and Tolerations</a>。</p><p>Taint 是 Node 的特性，一般包含 <code>key</code>，<code>value</code> 和 <code>effect</code>，表示形式为 <code>key=value:effect</code>。可以为 Node 打上 taint，以及一定的副作用。通过 <code>kubectl taint</code> 命令可以为 Node 添加或者删除 taint，例如：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加 taint</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> taint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dedicated=special-user:NoSchedule</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除 taint</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> taint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dedicated:NoSchedule-</span></span></code></pre></div><p>在上一部分的例子中，master 节点默认 taint 如下：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  taints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NoSchedule</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node-role.kubernetes.io/master</span></span></code></pre></div><p>通常默认情况下，master 节点是不允许调度 Pod 的，如果希望 master 节点也可以调度 Pod，可以执行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> taint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node-role.kubernetes.io/master-</span></span></code></pre></div><p>effect 的取值为：</p><ul><li><code>NoSchedule</code>：禁止调度</li><li><code>PreferNoSchedule</code>：优先不调度</li><li><code>NoExecute</code>：不调度到该节点，同时会驱逐已经调度到该节点的 Pod</li></ul><h2 id="管理" tabindex="-1">管理 <a class="header-anchor" href="#管理" aria-label="Permalink to &quot;管理&quot;">​</a></h2><h3 id="cordon-uncordon" tabindex="-1">cordon / uncordon <a class="header-anchor" href="#cordon-uncordon" aria-label="Permalink to &quot;cordon / uncordon&quot;">​</a></h3><p><code>cordon</code> 将节点标记为不可调度；<code>uncordon</code> 将节点重新标记为可调度。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cordon</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test-03</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-01</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      master</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   45d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-02</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                      &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   45d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test-03</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready,SchedulingDisabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   45d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.15.0</span></span></code></pre></div><h3 id="drain" tabindex="-1">drain <a class="header-anchor" href="#drain" aria-label="Permalink to &quot;drain&quot;">​</a></h3><p>如果需要将一个 Node 从集群中移除，则需要先执行 <code>kubectl drain &lt;node name&gt;</code> 操作。该操作会：</p><ul><li>标记该 Node 为不可调度 (<code>kubectl cordon &lt;node name&gt;</code>)</li><li>驱逐该 Node 上的 Pod</li></ul><p>通过 <code>--ignore-daemonsets</code> 可以忽略 DaemonSet；如果有 Pod 使用本地存储，例如 <code>emptyDir</code>，可以使用 <code>--delete-local-data</code> 参数。</p><p><code>drain</code> 操作结束后，即可将 Node 从集群中移除。如果想要 Node 继续使用，可以通过 <code>kubectl uncordon &lt;node name&gt;</code>.</p><p>该操作在驱逐 Pod 的时候，会遵循 <a href="./pod-disruption-budget.html">PodDisruptionBudget</a></p><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li><a href="https://kubernetes.io/docs/concepts/architecture/nodes/" target="_blank" rel="noreferrer">Nodes</a></li><li><a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noreferrer">Taints and Tolerations</a></li><li><a href="https://kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/" target="_blank" rel="noreferrer">Safely Drain a Node while Respecting the PodDisruptionBudget</a></li></ul>`,29),h=[e];function l(k,p,d,F,r,o){return a(),i("div",null,h)}const y=s(t,[["render",l]]);export{c as __pageData,y as default};
