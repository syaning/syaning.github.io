import{_ as s,o as a,c as n,a as l}from"./app.9c5b3fde.js";const p="/assets/datasource.ba50e3e8.png",o="/assets/metrics.6dd1a244.png",e="/assets/grafana.571c14ec.png",_=JSON.parse('{"title":"InfluxDB+Grafana\u642D\u5EFA\u76D1\u63A7\u7CFB\u7EDF","description":"","frontmatter":{"layout":"post","title":"InfluxDB+Grafana\u642D\u5EFA\u76D1\u63A7\u7CFB\u7EDF","date":"2018-08-10 00:30:00 +0800"},"headers":[],"relativePath":"my/post/2018-08-10-influxdb-grafana.md"}'),t={name:"my/post/2018-08-10-influxdb-grafana.md"},c=l(`<p>InfluxDB\u662F\u4E00\u4E2A\u65F6\u5E8F\u578B\u6570\u636E\u5E93\uFF0C\u4E3B\u8981\u7528\u4E8E\u5B58\u50A8\u65F6\u5E8F\u578B\u76F8\u5173\u7684\u6570\u636E\uFF0C\u4F8B\u5982\u5B9E\u65F6\u7684\u6E29\u5EA6\u3001\u6E7F\u5EA6\uFF0C\u8BA1\u7B97\u673A\u7684CPU\u4F7F\u7528\u7387\u3001\u5185\u5B58\u4F7F\u7528\u7387\u7B49\u3002\u65F6\u5E8F\u578B\u6570\u636E\u7684\u4E00\u4E9B\u4E3B\u8981\u7279\u70B9\u6709\uFF1A</p><ul><li>\u5199\u5165\u5E73\u7A33\uFF0C\u6301\u7EED\u5199\u5165</li><li>\u5199\u5165\u591A\uFF0C\u8BFB\u53D6\u5C11</li><li>\u5199\u5165\u7684\u6570\u636E\u51E0\u4E4E\u4E0D\u4F1A\u66F4\u65B0</li><li>\u6570\u636E\u91CF\u5927\uFF0C\u6570\u636E\u5177\u6709\u65F6\u6548\u6027</li><li>\u9700\u8981\u591A\u7CBE\u5EA6\u7684\u67E5\u8BE2</li><li>\u2026\u2026</li></ul><p>InfluxDB\u4E2D\u7684\u57FA\u672C\u6982\u5FF5\u662F\uFF1A</p><ul><li>measurement\uFF0C\u5BF9\u5E94\u5173\u7CFB\u6570\u636E\u5E93\u4E2D\u7684\u8868</li><li>tags\uFF0C\u5BF9\u5E94\u5173\u7CFB\u6570\u636E\u5E93\u4E2D\u7684\u7D22\u5F15\u5217</li><li>fields\uFF0C\u5BF9\u5E94\u5173\u7CFB\u6570\u636E\u5E93\u4E2D\u7684\u666E\u901A\u5217</li></ul><p>\u5176\u6570\u636E\u534F\u8BAE\u683C\u5F0F\u4E3A\uFF1A</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">&lt;measurement&gt;[,&lt;tag-key&gt;=&lt;tag-value&gt;...] &lt;field-key&gt;=&lt;field-value&gt;[,&lt;field2-key&gt;=&lt;field2-value&gt;...] [unix-nano-timestamp]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u4F8B\u5982\u4E0B\u9762\u7684\u90FD\u662F\u6709\u6548\u7684\u6570\u636E\uFF1A</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">cpu,host=serverA,region=us_west value=0.64</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">payment,device=mobile,product=Notepad,method=credit billed=33,licenses=3i 1434067467100293230</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">stock,symbol=AAPL bid=127.46,ask=127.48</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">temperature,machine=unit42,type=assembly external=25,internal=37 1434067467000000000</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>InfluxDB\u7ED3\u5408Grafana\uFF0C\u53EF\u4EE5\u8FDB\u884C\u6570\u636E\u7684\u76D1\u63A7\u3002\u4E0B\u9762\u662F\u4F7F\u7528docker\u505A\u7684\u4E00\u4E2A\u7B80\u5355\u4F8B\u5B50\u3002</p><p>\u9996\u5148\u542F\u52A8InfluxDB\u548CGrafana\uFF1A</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ docker run -d -p 8086:8086 -v </span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">PWD</span><span style="color:#C3E88D;">/influxdb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:/var/lib/influxdb --name influxdb influxdb</span></span>
<span class="line"><span style="color:#A6ACCD;">$ docker run -d -p 3000:3000 --name grafana --link influxdb grafana/grafana</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u8981\u5411InfluxDB\u4E2D\u5199\u5165\u6570\u636E\uFF0C\u8FD9\u91CC\u4F7F\u7528psutil\u6765\u7EDF\u8BA1CPU\u7684\u4F7F\u7528\u60C5\u51B5\uFF1A</p><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> psutil</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> influxdb </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> InfluxDBClient</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">gen_point</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">percent</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">measurement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cpu_load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">tags</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cpu</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cpu</span><span style="color:#F78C6C;">%d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;"> i</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fields</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">percent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> percent</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">8086</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    database </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">example</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">InfluxDBClient</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">host</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> port</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">database</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create_database</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">database</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">True:</span></span>
<span class="line"><span style="color:#A6ACCD;">        cpu_percent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> psutil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cpu_percent</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">interval</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">percpu</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">        data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">gen_point</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">idx </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> percent</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> idx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> percent </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enumerate</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">cpu_percent</span><span style="color:#89DDFF;">)]</span></span>
<span class="line"><span style="color:#A6ACCD;">        client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write_points</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u4E2A\u65F6\u5019\u5C31\u53EF\u4EE5\u67E5\u770B\u5230\u6570\u636E\u4E86\uFF1A</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ influxdb</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> use example</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">select</span><span style="color:#A6ACCD;"> * from cpu_load limit 5</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6D4F\u89C8\u5668\u6253\u5F00 localhost:3000\uFF0C\u767B\u5F55Grafana\uFF0C\u9996\u5148\u914D\u7F6E\u6570\u636E\u6E90\uFF1A</p><p><img src="`+p+'" alt=""></p><p>\u7136\u540E\u65B0\u5EFAdashboard\uFF0C\u914D\u7F6E\u56FE\u8868\uFF1A</p><p><img src="'+o+'" alt=""></p><p>\u7136\u540E\u5C31\u53EF\u4EE5\u770B\u5230\u7EDF\u8BA1\u56FE\u4E86\uFF1A</p><p><img src="'+e+'" alt=""></p>',21),r=[c];function D(F,y,A,C,i,d){return a(),n("div",null,r)}const f=s(t,[["render",D]]);export{_ as __pageData,f as default};
