import{_ as s,o as n,c as a,a as p}from"./app.291da3e0.js";const i=JSON.parse('{"title":"Express\u6DF1\u5165\u89E3\u8BFB","description":"","frontmatter":{"layout":"post","title":"Express\u6DF1\u5165\u89E3\u8BFB","date":"2015-10-22 12:00:00 +0800"},"headers":[{"level":2,"title":"\u4E00\u3001\u4F7F\u7528Express","slug":"\u4E00\u3001\u4F7F\u7528express","link":"#\u4E00\u3001\u4F7F\u7528express","children":[]},{"level":2,"title":"\u4E8C\u3001\u4E2D\u95F4\u4EF6","slug":"\u4E8C\u3001\u4E2D\u95F4\u4EF6","link":"#\u4E8C\u3001\u4E2D\u95F4\u4EF6","children":[]},{"level":2,"title":"\u4E09\u3001Router","slug":"\u4E09\u3001router","link":"#\u4E09\u3001router","children":[]},{"level":2,"title":"\u56DB\u3001\u53C2\u6570\u5904\u7406","slug":"\u56DB\u3001\u53C2\u6570\u5904\u7406","link":"#\u56DB\u3001\u53C2\u6570\u5904\u7406","children":[]},{"level":2,"title":"\u4E94\u3001\u8BF7\u6C42\u5904\u7406","slug":"\u4E94\u3001\u8BF7\u6C42\u5904\u7406","link":"#\u4E94\u3001\u8BF7\u6C42\u5904\u7406","children":[]},{"level":2,"title":"\u516D\u3001\u5185\u7F6E\u4E2D\u95F4\u4EF6","slug":"\u516D\u3001\u5185\u7F6E\u4E2D\u95F4\u4EF6","link":"#\u516D\u3001\u5185\u7F6E\u4E2D\u95F4\u4EF6","children":[]},{"level":2,"title":"\u4E03\u3001\u89C6\u56FE\u6E32\u67D3","slug":"\u4E03\u3001\u89C6\u56FE\u6E32\u67D3","link":"#\u4E03\u3001\u89C6\u56FE\u6E32\u67D3","children":[]}],"relativePath":"my/post/2015-10-22-express-in-depth.md"}'),l={name:"my/post/2015-10-22-express-in-depth.md"},o=p(`<div class="tip custom-block"><p class="custom-block-title">TIP</p><p>\u672C\u6587\u57FA\u4E8E<a href="https://github.com/strongloop/express/tree/4.13.3" target="_blank" rel="noreferrer">Express 4.13.3</a>\u3002</p></div><h2 id="\u4E00\u3001\u4F7F\u7528express" tabindex="-1">\u4E00\u3001\u4F7F\u7528Express <a class="header-anchor" href="#\u4E00\u3001\u4F7F\u7528express" aria-hidden="true">#</a></h2><p>\u901A\u5E38\u60C5\u51B5\u4E0B\uFF0C\u521B\u5EFA\u4E00\u4E2A\u7B80\u5355\u7684\u670D\u52A1\u5668\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> http </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createServer</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">4000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u4F7F\u7528Express\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">4000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4E3A\u4E86\u5BF9Express\u7684\u8FD0\u884C\u673A\u5236\u6709\u6240\u6DF1\u5165\u4E86\u89E3\uFF0C\u4E0D\u53EF\u907F\u514D\u5730\u9700\u8981\u7814\u7A76\u90E8\u5206\u6E90\u7801\u3002Express\u7684\u4E3B\u8981\u6E90\u7801\u7ED3\u6784\u5982\u4E0B\uFF1A</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">- lib/</span></span>
<span class="line"><span style="color:#A6ACCD;">    - middleware/</span></span>
<span class="line"><span style="color:#A6ACCD;">        - init.js</span></span>
<span class="line"><span style="color:#A6ACCD;">        - query.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    - router/</span></span>
<span class="line"><span style="color:#A6ACCD;">        - index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">        - layer.js</span></span>
<span class="line"><span style="color:#A6ACCD;">        - route.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    - application.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    - express.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    - request.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    - response.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    - utils.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    - view.js</span></span>
<span class="line"><span style="color:#A6ACCD;">- index.js</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u9996\u5148\uFF0C\u9700\u8981\u7406\u89E3\u4E0A\u9762\u4F8B\u5B50\u4E2D\u7684<code>express</code>\u548C<code>app</code>\u662F\u4EC0\u4E48\u3002\u90E8\u5206\u76F8\u5173\u6E90\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in express.js</span></span>
<span class="line"><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> createApplication</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createApplication</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// ... ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// in application.js</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">listen</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createServer</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">listen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arguments</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u51FA\uFF0C\u8C03\u7528<code>express()</code>\u8FD4\u56DE\u7684<code>app</code>\u5176\u5B9E\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u8C03\u7528<code>app.listen()</code>\u5176\u5B9E\u6267\u884C\u7684\u662F<code>http.createServer(app).listen()</code>\u3002\u56E0\u6B64\uFF0C<code>app</code>\u5176\u5B9E\u5C31\u662F\u4E00\u4E2A\u8BF7\u6C42\u5904\u7406\u51FD\u6570\uFF0C\u4F5C\u4E3A<code>http.createServer</code>\u7684\u53C2\u6570\u3002\u800C<code>express</code>\u5176\u5B9E\u662F\u4E00\u4E2A\u5DE5\u5382\u51FD\u6570\uFF0C\u7528\u6765\u751F\u6210\u8BF7\u6C42\u5904\u7406\u51FD\u6570\u3002</p><h2 id="\u4E8C\u3001\u4E2D\u95F4\u4EF6" tabindex="-1">\u4E8C\u3001\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#\u4E8C\u3001\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h2><p>Express\u4E2D\u4E00\u4E2A\u975E\u5E38\u6838\u5FC3\u7684\u6982\u5FF5\u5C31\u662F\u4E2D\u95F4\u4EF6\uFF08middleware\uFF09\u3002\u5728<a href="http://expressjs.com/guide/using-middleware.html" target="_blank" rel="noreferrer">\u5B98\u65B9\u6587\u6863</a>\u4E2D\uFF0C\u6709\u8FD9\u6837\u4E00\u53E5\u8BDD\uFF1A</p><blockquote><p>An Express application is essentially a series of middleware calls.</p></blockquote><p>\u4E5F\u5C31\u662F\u8BF4\uFF0C\u4E00\u4E2AExpress\u5E94\u7528\uFF0C\u4ECE\u672C\u8D28\u4E0A\u6765\u8BF4\uFF0C\u5C31\u662F\u4E00\u7CFB\u5217\u4E2D\u95F4\u4EF6\u7684\u8C03\u7528\u3002\u90A3\u4E48\uFF0C\u4E2D\u95F4\u4EF6\u5230\u5E95\u662F\u4EC0\u4E48\u5462\uFF1F\u5176\u5B9E\uFF0C\u4E00\u4E2A\u4E2D\u95F4\u4EF6\uFF0C\u5C31\u662F\u4E00\u4E2A\u51FD\u6570\u3002\u901A\u5E38\u60C5\u51B5\u4E0B\uFF0C\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u51FD\u6570\u7684\u5F62\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">middlewareName</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// do something</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u662F\u9519\u8BEF\u5904\u7406\u7684\u4E2D\u95F4\u4EF6\uFF0C\u5F62\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">middlewareName</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// do something</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u53C2\u6570\u4E2D\uFF0C<code>req</code>\u548C<code>res</code>\u5206\u522B\u8868\u793A\u8BF7\u6C42\u7684request\u548Cresponse\uFF0C<code>next</code>\u672C\u8EAB\u4E5F\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u8C03\u7528<code>next()</code>\u5C31\u4F1A\u7EE7\u7EED\u6267\u884C\u4E0B\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u3002\u5176\u5B9E\uFF0C\u8BF7\u6C42\u7684\u5904\u7406\u8FC7\u7A0B\u5927\u81F4\u5982\u4E0B\uFF0C\u5C31\u662F\u4F9D\u6B21\u7ECF\u8FC7\u5404\u4E2A\u4E2D\u95F4\u4EF6\u3002</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">       \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------</span></span>
<span class="line"><span style="color:#A6ACCD;">| middleware1 |</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------</span></span>
<span class="line"><span style="color:#A6ACCD;">       \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------</span></span>
<span class="line"><span style="color:#A6ACCD;">| ... ... ... |</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------</span></span>
<span class="line"><span style="color:#A6ACCD;">       \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------</span></span>
<span class="line"><span style="color:#A6ACCD;">| middlewareN |</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------</span></span>
<span class="line"><span style="color:#A6ACCD;">       \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u4E2D\u95F4\u4EF6\u5927\u4F53\u4E0A\u53EF\u4EE5\u5206\u4E3A\u4E24\u79CD\uFF1A\u666E\u901A\u4E2D\u95F4\u4EF6\u548C\u8DEF\u7531\u4E2D\u95F4\u4EF6\u3002\u6CE8\u518C\u666E\u901A\u4E2D\u95F4\u4EF6\uFF0C\u901A\u5E38\u662F\u901A\u8FC7<code>app.use()</code>\u65B9\u6CD5\uFF1B\u800C\u6CE8\u518C\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u901A\u5E38\u662F\u901A\u8FC7<code>app.METHOD()</code>\u65B9\u6CD5\u3002\u4F8B\u5982\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// do something</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// do something</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4F8B\u5B50\u4E2D\u7684\u4E24\u8005\u6709\u4EE5\u4E0B\u533A\u522B\uFF1A</p><ul><li>\u524D\u8005\u5339\u914D\u6240\u6709\u4EE5<code>/user</code>\u5F00\u59CB\u7684\u8DEF\u5F84\uFF0C\u800C\u540E\u8005\u4F1A\u7CBE\u786E\u5339\u914D<code>/user</code>\u8DEF\u5F84\uFF1B</li><li>\u524D\u8005\u5BF9\u4E8E\u8BF7\u6C42\u7684\u65B9\u6CD5\u6CA1\u6709\u9650\u5236\uFF0C\u800C\u540E\u8005\u53EA\u80FD\u5904\u7406\u65B9\u6CD5\u4E3AGET\u7684\u8BF7\u6C42\u3002</li></ul><p>\u5728\u4E0A\u9762\u63D0\u5230\u4E86\u5982\u4E0B\u6E90\u7801\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in express.js</span></span>
<span class="line"><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> createApplication</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createApplication</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// ... ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6240\u6709\u7684\u8BF7\u6C42\uFF0C\u5176\u5B9E\u90FD\u662F\u7531<code>app.handle()</code>\u6765\u5904\u7406\u7684\u3002\u5728\u4E86\u89E3\u8BF7\u6C42\u5904\u7406\u7684\u8BE6\u7EC6\u8FC7\u7A0B\u4E4B\u524D\uFF0C\u9700\u8981\u5148\u6765\u4E86\u89E3Router\u3002</p><h2 id="\u4E09\u3001router" tabindex="-1">\u4E09\u3001Router <a class="header-anchor" href="#\u4E09\u3001router" aria-hidden="true">#</a></h2><p>\u7B80\u5355\u6765\u8BF4\uFF0CRouter\uFF08\u6E90\u7801\u5728<code>router/index.js</code>\uFF09\u5C31\u662F\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u7684\u5BB9\u5668\u3002\u4E8B\u5B9E\u4E0A\uFF0CRouter\u662FExpress\u4E2D\u4E00\u4E2A\u975E\u5E38\u6838\u5FC3\u7684\u4E1C\u897F\uFF0C\u57FA\u672C\u4E0A\u5C31\u662F\u4E00\u4E2A\u7B80\u5316\u7248\u7684Express\u6846\u67B6\u3002app\u7684\u5F88\u591AAPI\uFF0C\u4F8B\u5982\uFF1A<code>app.use()</code>\uFF0C<code>app.param()</code>\uFF0C<code>app.handle()</code>\u7B49\uFF0C\u4E8B\u5B9E\u4E0A\u90FD\u662F\u5BF9Router\u7684API\u7684\u4E00\u4E2A\u7B80\u5355\u5305\u88C5\u3002\u53EF\u4EE5\u901A\u8FC7<code>app._router</code>\u6765\u8BBF\u95EE\u9ED8\u8BA4\u7684Router\u5BF9\u8C61\u3002</p><p>Router\u5BF9\u8C61\u6709\u4E00\u4E2A<code>stack</code>\u5C5E\u6027\uFF0C\u4E3A\u4E00\u4E2A\u6570\u7EC4\uFF0C\u5B58\u653E\u7740\u6240\u6709\u7684\u4E2D\u95F4\u4EF6\u3002\u5F53\u8C03\u7528<code>app.use()</code>\u7684\u65F6\u5019\uFF0C\u5B9E\u9645\u4E0A\u662F\u6267\u884C\u4E86<code>router.use()</code>\uFF0C\u4ECE\u800C\u5411<code>router.stack</code>\u6570\u7EC4\u4E2D\u6DFB\u52A0\u4E2D\u95F4\u4EF6\u3002<code>router.stack</code>\u4E2D\u7684\u6BCF\u4E00\u9879\u662F\u4E00\u4E2A<code>Layer</code>\uFF08\u6E90\u7801\u5728<code>router/layer.js</code>\uFF09\u5BF9\u8C61\uFF0C\u5B83\u662F\u5BF9\u4E2D\u95F4\u4EF6\u51FD\u6570\u7684\u4E00\u4E2A\u5C01\u88C5\u3002\u6DFB\u52A0\u4E2D\u95F4\u4EF6\u7684\u90E8\u5206\u76F8\u5173\u6E90\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in router/index.js, proto.use()</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> layer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Layer</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">sensitive</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">caseSensitive</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">strict</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">end</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> fn)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">layer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">route </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">stack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#A6ACCD;">(layer)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5BF9\u4E8E\u666E\u901A\u7684\u4E2D\u95F4\u4EF6\uFF0C\u6DFB\u52A0\u8FC7\u7A0B\u5C31\u5927\u81F4\u5982\u6B64\u3002\u4E0D\u8FC7\uFF0C\u5BF9\u4E8E\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5C31\u7A0D\u5FAE\u590D\u6742\u4E86\u4E00\u4E9B\u3002\u5728\u6B64\u4E4B\u524D\uFF0C\u5148\u6765\u770B\u4E00\u4E0B\u6DFB\u52A0\u8DEF\u7531\u4E2D\u95F4\u4EF6\u7684\u51E0\u79CD\u65B9\u6CD5\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// app.METHOD --&gt; router.route --&gt; route.METHOD</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// app.all --&gt; router.route --&gt; route.METHOD</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// app.route --&gt; router.route --&gt; route.METHOD</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// router.METHOD/all --&gt; router.route --&gt; route.METHOD/all</span></span>
<span class="line"><span style="color:#A6ACCD;">router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u65E0\u8BBA\u662F\u54EA\u4E00\u79CD\u65B9\u6CD5\u6DFB\u52A0\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u90FD\u9700\u8981\u901A\u8FC7<code>router.route()</code>\u6765\u521B\u5EFA\u4E00\u6761\u65B0\u7684\u8DEF\u7531\uFF0C\u7136\u540E\u8C03\u7528<code>route.METHOD()/all()</code>\u6765\u6CE8\u518C\u76F8\u5173\u7684\u5904\u7406\u51FD\u6570\u3002\u56E0\u6B64\uFF0C\u9996\u5148\u9700\u8981\u4E86\u89E3Route\uFF08\u6E90\u7801\u5728<code>router/route.js</code>\uFF09\u5BF9\u8C61\u3002</p><p>Route\u53EF\u4EE5\u7B80\u5355\u7406\u89E3\u4E3A\u5B58\u653E\u8DEF\u7531\u5904\u7406\u51FD\u6570\u7684\u5BB9\u5668\uFF0C\u5B83\u4E5F\u6709\u4E00\u4E2A<code>stack</code>\u5C5E\u6027\uFF0C\u4E3A\u4E00\u4E2A\u6570\u7EC4\uFF0C\u5176\u4E2D\u7684\u6BCF\u4E00\u9879\u4E5F\u662F\u4E00\u4E2ALayer\u5BF9\u8C61\uFF0C\u662F\u5BF9\u8DEF\u7531\u5904\u7406\u51FD\u6570\u7684\u5305\u88C5\u3002\u4E0B\u9762\u6765\u770B\u5F53\u6267\u884C<code>router.route()</code>\u7684\u65F6\u5019\u53D1\u751F\u4E86\u4EC0\u4E48\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in router/index.j</span></span>
<span class="line"><span style="color:#A6ACCD;">proto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">route</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">route</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Route</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">layer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Layer</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		sensitive</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">caseSensitive</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		strict</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">strict</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		end</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">route</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dispatch</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bind</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">route</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">layer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">route</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">route</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">stack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">layer</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">route</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5F53\u8C03\u7528<code>router.route()</code>\u7684\u65F6\u5019\uFF0C\u5B9E\u9645\u4E0A\u662F\u65B0\u5EFA\u4E86\u4E00\u4E2A<code>layer</code>\u653E\u5728<code>router.stack</code>\u4E2D\uFF1B\u5E76\u8BBE\u7F6E<code>layer.route</code>\u4E3A\u65B0\u5EFA\u7684Route\u5BF9\u8C61\u3002</p><p>\u4E0B\u9762\u6765\u770B<code>route.METHOD</code>\u7684\u65F6\u5019\u53D1\u751F\u4E86\u4EC0\u4E48\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in router/route.js</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> layer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Layer</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span><span style="color:#A6ACCD;"> handle)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">layer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">method </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> method</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">methods[method] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">stack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#A6ACCD;">(layer)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5373\uFF0C\u5F53\u8C03\u7528<code>route.METHOD()</code>\u7684\u65F6\u5019\uFF0C\u65B0\u5EFA\u4E00\u4E2A<code>layer</code>\u653E\u5728<code>route.stack</code>\u4E2D\u3002</p><p>\u901A\u8FC7\u4E0A\u9762\u7684\u5206\u6790\u53EF\u4EE5\u53D1\u73B0\uFF0CRouter\u5176\u5B9E\u662F\u4E00\u4E2A\u4E8C\u7EF4\u7684\u7ED3\u6784\u3002\u4F8B\u5982\uFF0C\u4E00\u4E2A\u53EF\u80FD\u7684<code>router.stack</code>\u7ED3\u6784\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layer1    |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------- layer2.route.stack  ------------   ------------   ------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layer2    | ------------------&gt; | layer2-1 |--&gt;| layer2-2 |--&gt;| layer2-3 |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------                     ------------   ------------   ------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------- layer3.route.stack  ------------   ------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layer3    | ------------------&gt; | layer3-1 |--&gt;| layer3-2 |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------                     ------------   ------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    ......    |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layerN    |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="\u56DB\u3001\u53C2\u6570\u5904\u7406" tabindex="-1">\u56DB\u3001\u53C2\u6570\u5904\u7406 <a class="header-anchor" href="#\u56DB\u3001\u53C2\u6570\u5904\u7406" aria-hidden="true">#</a></h2><p>\u5728\u5F88\u591A\u65F6\u5019\uFF0C\u8DEF\u7531\u4E2D\u662F\u5E26\u6709\u53C2\u6570\u7684\uFF0C\u5C24\u5176\u662FRestful\u98CE\u683C\u7684API\u3002\u4F8B\u5982<code>/user/name</code>\uFF0C\u53EF\u80FD<code>name</code>\u662F\u4E2A\u52A8\u6001\u7684\u503C\uFF0C\u4ECE\u800C\u53BB\u6570\u636E\u5E93\u4E2D\u67E5\u8BE2\u51FA\u76F8\u5173\u7684\u7528\u6237\u3002\u56E0\u6B64\uFF0C\u5728Router\u4E2D\uFF0C\u901A\u5E38\u4F1A\u6D89\u53CA\u5230\u53C2\u6570\u7684\u5904\u7406\u3002</p><p>\u5148\u770B\u5982\u4E0B\u4F8B\u5B50\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/:name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">user</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">queryUser</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">val</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u901A\u8FC7<code>app.param()</code>\u53EF\u4EE5\u6CE8\u518C\u53C2\u6570\u5904\u7406\u51FD\u6570\uFF0C\u4E8B\u5B9E\u4E0A\uFF0C<code>app.param()</code>\u8C03\u7528\u4E86<code>router.param()</code>\u3002Router\u6709\u4E00\u4E2A<code>params</code>\u5C5E\u6027\uFF0C\u5176\u503C\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u7528\u6765\u5B58\u50A8\u53C2\u6570\u7684\u5904\u7406\u51FD\u6570\u3002\u4F8B\u5982\uFF0C\u4E00\u4E2A\u53EF\u80FD\u7684<code>router.params</code>\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">processName</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">queryName</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">queryId</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u4E2D<code>processName</code>\uFF0C<code>queryName</code>\uFF0C<code>queryId</code>\u8868\u793A\u7684\u90FD\u662F\u51FD\u6570\uFF0C\u5373\u901A\u8FC7<code>app.param()</code>\u6216<code>router.param()</code>\u6240\u6CE8\u518C\u7684\u53C2\u6570\u5904\u7406\u51FD\u6570\u3002</p><p>\u7136\u540E\u5728\u5904\u7406\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u4F1A\u4F7F\u7528\u76F8\u5E94\u7684\u4E0E\u5904\u7406\u51FD\u6570\u5BF9\u8BF7\u6C42URL\u4E2D\u7684\u53C2\u6570\u8FDB\u884C\u5904\u7406\u3002</p><h2 id="\u4E94\u3001\u8BF7\u6C42\u5904\u7406" tabindex="-1">\u4E94\u3001\u8BF7\u6C42\u5904\u7406 <a class="header-anchor" href="#\u4E94\u3001\u8BF7\u6C42\u5904\u7406" aria-hidden="true">#</a></h2><p>\u524D\u9762\u6240\u63D0\u5230\u7684\uFF0C\u65E0\u8BBA\u662F\u6DFB\u52A0\u4E2D\u95F4\u4EF6\uFF0C\u8FD8\u662F\u53C2\u6570\u5904\u7406\u51FD\u6570\uFF0C\u90FD\u662F\u5E94\u7528\u7684\u6784\u5EFA\u8FC7\u7A0B\u3002\u5F53\u5E94\u7528\u6784\u5EFA\u597D\u4E86\u4E4B\u540E\uFF0C\u5BA2\u6237\u7AEF\u53D1\u8D77\u8BF7\u6C42\uFF0C\u8FD9\u4E2A\u65F6\u5019\uFF0C\u5E94\u7528\u5C31\u5F00\u59CB\u4F7F\u7528\u524D\u9762\u7684\u4E2D\u95F4\u4EF6\u548C\u53C2\u6570\u5904\u7406\u51FD\u6570\uFF0C\u6765\u5904\u7406\u5BA2\u6237\u7AEF\u7684\u8BF7\u6C42\u3002</p><p>\u524D\u9762\u63D0\u5230\uFF0C\u6240\u6709\u7684\u8BF7\u6C42\uFF0C\u90FD\u662F\u7531<code>app.handle()</code>\u6765\u5904\u7406\u7684\uFF0C\u901A\u8FC7\u770B\u6E90\u7801\uFF0C\u53EF\u4EE5\u53D1\u73B0\uFF0C\u5176\u5B9E<code>app.handle()</code>\u662F\u8C03\u7528\u4E86<code>router.handle()</code>\u3002<code>router.handle</code>\u7684\u6E90\u7801\u6BD4\u8F83\u590D\u6742\uFF0C\u5728<a href="https://github.com/syaning/understanding-express/blob/master/express/router/index.md#7-protohandle" target="_blank" rel="noreferrer">\u8FD9\u91CC</a>\u6709\u4E00\u4E2A\u7B80\u5355\u7684\u5206\u6790\u3002</p><p>\u5F53\u8BF7\u6C42\u5230\u6765\u65F6\uFF0C\u7ECF\u8FC7\u4E2D\u95F4\u4EF6\u7684\u987A\u5E8F\u5927\u81F4\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layer1    |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layer2    |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------- layer3.route.stack  ------------   ------------   ------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layer3    | ------------------&gt; | layer3-1 |--&gt;| layer3-2 |--&gt;| layer3-3 | ---</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------                     ------------   ------------   ------------   |</span></span>
<span class="line"><span style="color:#A6ACCD;">                                                                                  |</span></span>
<span class="line"><span style="color:#A6ACCD;">        ---------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------- layer4.route.stack  ------------   ------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layer4    | ------------------&gt; | layer4-1 |--&gt;| layer4-2 | ---</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------                     ------------   ------------   |</span></span>
<span class="line"><span style="color:#A6ACCD;">                                                                   |</span></span>
<span class="line"><span style="color:#A6ACCD;">        ------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    ......    |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|    layerN    |</span></span>
<span class="line"><span style="color:#A6ACCD;">----------------</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5373\uFF0C\u8BF7\u6C42\u4F1A\u4F9D\u6B21\u7ECF\u8FC7\u5404\u4E2A\u4E2D\u95F4\u4EF6\uFF0C\u5982\u679C\u662F\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u4F1A\u4F9D\u6B21\u7ECF\u8FC7\u5176\u4E2D\u7684\u5404\u4E2A\u8DEF\u7531\u51FD\u6570\u3002\u5F53\u8BF7\u6C42\u5230\u8FBE\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u7684\u65F6\u5019\uFF0C\u4F1A\u8FDB\u884C\u5982\u4E0B\u5224\u65AD\uFF1A</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">                \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;">  No  --------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">------|    path match    |</span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">|               \u2193 Yes</span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------  Yes  ---------------------  No</span></span>
<span class="line"><span style="color:#A6ACCD;">|     |     has route    |-------| http method match |------</span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------       ---------------------     |</span></span>
<span class="line"><span style="color:#A6ACCD;">|               \u2193 No                       | Yes           |</span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------                 |               |</span></span>
<span class="line"><span style="color:#A6ACCD;">|     |  process params  |&lt;-----------------               |    </span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------                                 |</span></span>
<span class="line"><span style="color:#A6ACCD;">|               \u2193                                          |</span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------                                 |</span></span>
<span class="line"><span style="color:#A6ACCD;">|     | execute function |                                 |</span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------                                 |</span></span>
<span class="line"><span style="color:#A6ACCD;">|               \u2193                                          |</span></span>
<span class="line"><span style="color:#A6ACCD;">|     --------------------                                 |</span></span>
<span class="line"><span style="color:#A6ACCD;">-----&gt;|    next layer    |&lt;---------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">      --------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">                \u2193</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li>\u9996\u5148\u5224\u65AD\u8DEF\u5F84\u662F\u5426\u5339\u914D\uFF0C\u5982\u679C\u8DEF\u5F84\u4E0D\u5339\u914D\uFF0C\u5219\u76F4\u63A5\u8DF3\u8FC7\u8BE5\u4E2D\u95F4\u4EF6</li><li>\u7136\u540E\u5224\u65AD\u662F\u5426\u4E3A\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5982\u679C\u4E0D\u662F\uFF0C\u5373\u5982\u679C\u662F\u666E\u901A\u7684\u4E2D\u95F4\u4EF6\uFF0C\u5219\u8FDB\u884C\u53C2\u6570\u5904\u7406\uFF0C\u5E76\u6267\u884C\u4E2D\u95F4\u4EF6\u51FD\u6570</li><li>\u5982\u679C\u662F\u8DEF\u7531\u4E2D\u95F4\u4EF6\uFF0C\u5219\u5224\u65ADHTTP\u8BF7\u6C42\u65B9\u6CD5\u662F\u5426\u5339\u914D\uFF0C\u5982\u679C\u5339\u914D\uFF0C\u5219\u8FDB\u884C\u53C2\u6570\u5904\u7406\uFF0C\u5E76\u6267\u884C\u4E2D\u95F4\u4EF6\u51FD\u6570\uFF08\u8BE5\u4E2D\u95F4\u4EF6\u51FD\u6570\u5B9E\u9645\u4E0A\u662F<code>route.dispatch()</code>\uFF09\uFF1B\u5426\u5219\u8DF3\u8FC7\u8BE5\u4E2D\u95F4\u4EF6</li></ul><p>\u4F1A\u53D1\u73B0\uFF0C\u5982\u679C\u6709\u591A\u4E2A\u4E2D\u95F4\u4EF6\u5339\u914D\u7684\u8BDD\uFF0C\u5728\u6BCF\u4E2A\u4E2D\u95F4\u4EF6\u51FD\u6570\u6267\u884C\u4E4B\u524D\uFF0C\u90FD\u6709\u4E00\u4E2A\u53C2\u6570\u5904\u7406\u7684\u8FC7\u7A0B\uFF0C\u90A3\u4E48\uFF0C\u53C2\u6570\u4E0E\u5904\u7406\u51FD\u6570\u4F1A\u4E0D\u4F1A\u88AB\u591A\u6B21\u6267\u884C\u5462\uFF1F\u4E8B\u5B9E\u4E0A\uFF0C\u5728<code>router.handle()</code>\u7684\u65F6\u5019\uFF0C\u9488\u5BF9\u53C2\u6570\u7684\u5904\u7406\uFF0C\u5F15\u5165\u4E86\u7F13\u5B58\u673A\u5236\uFF0C\u56E0\u6B64\uFF0C\u6BCF\u4E2A\u53C2\u6570\u7684\u5904\u7406\u51FD\u6570\u53EA\u4F1A\u6267\u884C\u4E00\u6B21\uFF0C\u5E76\u5C06\u7ED3\u679C\u4FDD\u5B58\u5728\u7F13\u5B58\u4E2D\u3002\u5728\u5904\u7406\u540C\u4E00\u4E2A\u8BF7\u6C42\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679C\u9700\u8981\u5904\u7406\u67D0\u4E2A\u53C2\u6570\uFF0C\u4F1A\u9996\u5148\u68C0\u67E5\u7F13\u5B58\uFF0C\u5982\u679C\u7F13\u5B58\u4E2D\u4E0D\u5B58\u5728\uFF0C\u624D\u4F1A\u6267\u884C\u5176\u5904\u7406\u51FD\u6570\u3002</p><h2 id="\u516D\u3001\u5185\u7F6E\u4E2D\u95F4\u4EF6" tabindex="-1">\u516D\u3001\u5185\u7F6E\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#\u516D\u3001\u5185\u7F6E\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h2><p>\u5728\u521D\u59CB\u5316<code>app._router</code>\u7684\u65F6\u5019\uFF0C\u5C31\u52A0\u8F7D\u4E86<code>middleware/query.js</code>\u548C<code>middleware/init.js</code>\u8FD9\u4E24\u4E2A\u4E2D\u95F4\u4EF6\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in application.js</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lazyrouter</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lazyrouter</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!this.</span><span style="color:#A6ACCD;">_router</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_router</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Router</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			caseSensitive</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">enabled</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">case sensitive routing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">			strict</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">enabled</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">strict routing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">query</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query parser fn</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_router</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">middleware</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">init</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>\u7B2C\u4E00\u4E2A\u4E2D\u95F4\u4EF6\u7684\u4F5C\u7528\u4E3B\u8981\u662F\u89E3\u6790URL query\u3002<code>query(this.get(&#39;query parser fn&#39;))</code>\u7684\u4F5C\u7528\u662F\u8BBE\u7F6EURL query\u7684\u89E3\u6790\u5668\uFF0C\u5E76\u8FD4\u56DE\u76F8\u5E94\u7684\u4E2D\u95F4\u4EF6\u51FD\u6570\u3002\u8BE5\u90E8\u5206\u4EE3\u7801\u6BD4\u8F83\u7B80\u5355\uFF0C\u4E0D\u505A\u8D58\u8FF0\u3002</p><p>\u7B2C\u4E8C\u4E2A\u4E2D\u95F4\u4EF6\u7684\u4F5C\u7528\u4E3B\u8981\u662F\u5C06<code>req</code>\u548C<code>res</code>\u5206\u522B\u66B4\u9732\u7ED9\u5BF9\u65B9\uFF0C\u5E76\u4E14\u8BA9\u5B83\u4EEC\u5206\u522B\u7EE7\u627F\u81EA<code>app.request</code>\u548C<code>app.response</code>\u3002\u6D89\u53CA\u5230\u7684\u76F8\u5173\u6E90\u7801\u4E3A\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// in middleware/init.js</span></span>
<span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#82AAFF;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">expressInit</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;">// ... ...</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">req</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">next</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">next</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__proto__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__proto__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">		</span><span style="color:#676E95;">// ... ...</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// in express.js</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createApplication</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// ... ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> __proto__</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> app</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> __proto__</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> app</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// ... ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u56E0\u6B64\uFF0C\u5176\u5B9E\u662F\u8BA9<code>req</code>\u548C<code>res</code>\u5206\u522B\u7EE7\u627F\u81EA\u4E86<code>request.js</code>\u548C<code>response.js</code>\u7684\u5BFC\u51FA\u5BF9\u8C61\uFF0C\u7B80\u5355\u6765\u8BF4\uFF0C\u5C31\u662F\u5BF9<code>req</code>\u548C<code>res</code>\u8FDB\u884C\u4E86\u5C5E\u6027\u548C\u65B9\u6CD5\u7684\u6269\u5C55\u3002</p><p>\u53E6\u5916\uFF0CExpress\u4E2D\u8FD8\u6709\u4E00\u4E2A\u5185\u7F6E\u7684\u4E2D\u95F4\u4EF6\uFF0C\u5373<code>express.static</code>\uFF0C\u5B83\u4F9D\u8D56\u7684\u662F<a href="https://github.com/expressjs/serve-static" target="_blank" rel="noreferrer">serve-static</a>\u6A21\u5757\uFF0C\u4E3B\u8981\u7528\u4E8E\u521B\u5EFA\u9759\u6001\u8D44\u6E90\u670D\u52A1\u3002</p><h2 id="\u4E03\u3001\u89C6\u56FE\u6E32\u67D3" tabindex="-1">\u4E03\u3001\u89C6\u56FE\u6E32\u67D3 <a class="header-anchor" href="#\u4E03\u3001\u89C6\u56FE\u6E32\u67D3" aria-hidden="true">#</a></h2><p>\u6E32\u67D3\u6A21\u677F\u4F7F\u7528\u7684\u662F<code>res.render()</code>\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">alex</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u5B9E\uFF0C<code>res.render()</code>\u8C03\u7528\u4E86<code>app.render()</code>\u3002\u5728<code>app.render()</code>\u4E2D\uFF0C\u5148\u521B\u5EFA\u4E00\u4E2A<code>view</code>\u5BF9\u8C61\uFF08\u76F8\u5173\u6E90\u7801\u4E3A<code>view.js</code>\uFF09\uFF0C\u7136\u540E\u8C03\u7528<code>view.render()</code>\u3002\u5982\u679C\u5141\u8BB8\u7F13\u5B58\uFF0C\u5373<code>app.enabled(&#39;view cache&#39;)</code>\u7684\u8BDD\uFF0C\u5219\u4F1A\u4F18\u5148\u68C0\u67E5\u7F13\u5B58\uFF0C\u5982\u679C\u7F13\u5B58\u4E2D\u5DF2\u6709\u76F8\u5173\u89C6\u56FE\uFF0C\u5219\u76F4\u63A5\u53D6\u51FA\uFF1B\u5426\u5219\u624D\u4F1A\u65B0\u521B\u5EFA\u4E00\u4E2A\u89C6\u56FE\u5BF9\u8C61\u3002</p><p>\u8BE5\u90E8\u5206\u6BD4\u8F83\u7B80\u5355\uFF0C\u4E0D\u505A\u8D58\u8FF0\u3002</p>`,72),e=[o];function c(t,r,y,D,F,A){return n(),a("div",null,e)}const d=s(l,[["render",c]]);export{i as __pageData,d as default};
