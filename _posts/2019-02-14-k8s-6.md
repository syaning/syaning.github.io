---
layout: post
title:  k8s学习笔记(6)——Secret & ConfigMap
date:   2019-02-14 00:30:00 +0800
---

## 一、Secret

对于用户名、密码、token、密钥等这些比较敏感的信息，不应该直接写在配置文件中，而应该创建成Secret来使用。

### 1. 创建Secret

Secret的创建主要有如下几种方式：

(1) from literal

```sh
$ kubectl create secret generic db-user-pass --from-literal=username=admin --from-literal=password=123456
```

(2) from file

```sh
$ echo -n admin > ./username
$ echo -n 123456 > ./password
$ kubectl create secret generic db-user-pass --from-file=./username --from-file=./password
```

(3) from env file

```sh
$ echo username=admin >> ./env.txt
$ echo password=123456 >> ./env.txt
$ kubectl create secret generic db-user-pass --from-env-file=./env.txt
```

(4) from yml file

```sh
$ echo -n 'admin' | base64
# YWRtaW4=

$ echo -n '123456' | base64
# MTIzNDU2
```

secret.yml:

```yml
apiVersion: v1
kind: Secret
metadata:
  name: db-user-pass
type: Opaque
data:
  username: YWRtaW4=
  password: MTIzNDU2
```

然后执行

```sh
$ kubectl apply -f secret.yml
```

### 2. 查看Secret

如果要查看Secret，可以使用：

```sh
$ kubectl describe secret db-user-pass
```

结果如下：

```
Name:         db-user-pass
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  6 bytes
username:  5 bytes
```

这里无法查看到username和password的具体值，如果想要看具体的值，可以使用：

```sh
$ kubectl edit secret db-user-pass
```

结果如下：

```yml
# Please edit the object below. Lines beginning with a '#' will be ignored,
# and an empty file will abort the edit. If an error occurs while saving this file will be
# reopened with the relevant failures.
#
apiVersion: v1
data:
  password: MTIzNDU2
  username: YWRtaW4=
kind: Secret
metadata:
  creationTimestamp: 2019-02-13T16:16:08Z
  name: db-user-pass
  namespace: default
  resourceVersion: "13730"
  selfLink: /api/v1/namespaces/default/secrets/db-user-pass
  uid: aba61376-2faa-11e9-95b4-025000000001
type: Opaque
```

通过base64解码即可看到具体值：

```sh
$ echo MTIzNDU2 | base64 --decode
# 123456

$ echo YWRtaW4= | base64 --decode
# admin
```

## 二、ConfigMap

ConfigMap与Secret非常类似，只不过是用来创建非敏感的配置信息，且以明文方式存储。

### 1. 创建ConfigMap

ConfigMap的创建与Secret一样，也支持以下几种方式：

(1) from literal

```sh
$ kubectl create configmap appconfig --from-literal=appname=testapp --from-literal=locale=zh-CN
```

(2) from file

```sh
$ echo -n testapp > ./appname
$ echo -n zh-CN > ./locale
$ kubectl create configmap appconfig --from-file=./appname --from-file=./locale
```

(3) from env file

```sh
$ echo appname=testapp >> ./env.txt
$ echo locale=zh-CN >> ./env.txt
$ kubectl create configmap appconfig --from-env-file=./env.txt
```

(4) from yml file

configmap.yml:

```yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: appconfig
data:
  appname: testapp
  locale: zh-CN
```

然后执行

```sh
$ kubectl apply -f configmap.yml
```

### 2. 查看ConfigMap

如果要查看ConfigMap，可以使用：

```sh
$ kubectl describe configmap appconfig
```

结果如下：

```
Name:         appconfig
Namespace:    default
Labels:       <none>
Annotations:  <none>

Data
====
appname:
----
testapp
locale:
----
zh-CN
Events:  <none>
```